<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>FFA project group 7</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ffa_proj_files/libs/clipboard/clipboard.min.js"></script>
<script src="ffa_proj_files/libs/quarto-html/quarto.js"></script>
<script src="ffa_proj_files/libs/quarto-html/popper.min.js"></script>
<script src="ffa_proj_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ffa_proj_files/libs/quarto-html/anchor.min.js"></script>
<link href="ffa_proj_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ffa_proj_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ffa_proj_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ffa_proj_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ffa_proj_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="ffa_proj_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="ffa_proj_files/libs/plotly-binding-4.10.3/plotly.js"></script>
<script src="ffa_proj_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="ffa_proj_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="ffa_proj_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="ffa_proj_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="ffa_proj_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="ffa_proj_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">FFA project group 7</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="loading-essential-packages" class="level1">
<h1>Loading essential packages</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'stringr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DataExplorer) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'DataExplorer' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plotly'

The following object is masked from 'package:ggplot2':

    last_plot

The following object is masked from 'package:stats':

    filter

The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(moments)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yardstick)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'yardstick'

The following object is masked from 'package:readr':

    spec</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'recipes'

The following object is masked from 'package:stringr':

    fixed

The following object is masked from 'package:stats':

    step</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parsnip)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix

Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack

Loaded glmnet 4.1-8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coefplot)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.1.1 ──
✔ broom        1.0.5     ✔ rsample      1.2.0
✔ dials        1.2.0     ✔ tune         1.1.2
✔ infer        1.0.5     ✔ workflows    1.1.3
✔ modeldata    1.2.0     ✔ workflowsets 1.0.1
── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ Matrix::expand()  masks tidyr::expand()
✖ plotly::filter()  masks dplyr::filter(), stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ Matrix::pack()    masks tidyr::pack()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()
✖ Matrix::unpack()  masks tidyr::unpack()
✖ Matrix::update()  masks recipes::update(), stats::update()
• Use tidymodels_prefer() to resolve common conflicts.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'xgboost'

The following object is masked from 'package:plotly':

    slice

The following object is masked from 'package:dplyr':

    slice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice

Attaching package: 'caret'

The following objects are masked from 'package:yardstick':

    precision, recall, sensitivity, specificity

The following object is masked from 'package:purrr':

    lift</code></pre>
</div>
</div>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>1. Exploratory Data Analysis</h1>
<section id="original-data" class="level2">
<h2 class="anchored" data-anchor-id="original-data">1.1 Original data</h2>
<p>Load dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/rayne/Documents/y4s2/ACCT420_forensic_forecasting/Bank Data 2000-2023 (Glossary).csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 162408 Columns: 525
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (43): freq, Ticker Symbol_05601, Cusip_06004, Sedol_06006, Isin_06008,...
dbl  (461): code, year_, Net Sales Or Revenues_01001, Costs Of Goods Sold_01...
lgl   (16): Indicator  Restatement Type Key Items In Us Dollars_11557, Indic...
dttm   (1): Date Of Incorporation_18273
date   (4): Fiscal Period End Date_05350, Inactive Date_07015, Date Added To...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>162408 observations of 525 variables</p>
<p>Taking a look at the columns (525 columns too long so I wont run)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#names(df)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Firstly, filter companies whose General Code is 4 for banks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">General Industry Classification_06010</span><span class="st">`</span><span class="sc">==</span><span class="dv">4</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1 46181</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code)<span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()<span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  3053</code></pre>
</div>
</div>
<p>From 162k observations to 46k observations once we filter banks only, and 3053 unique companies</p>
<p>Getting a sense of how many countries in the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Nation_06026)<span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">country_counts=</span><span class="fu">n</span>())<span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(country_counts))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 125 × 2
   Nation_06026   country_counts
   &lt;chr&gt;                   &lt;int&gt;
 1 UNITED STATES           16839
 2 JAPAN                    2413
 3 INDIA                    1022
 4 INDONESIA                 938
 5 CHINA                     851
 6 NORWAY                    740
 7 BRAZIL                    681
 8 DENMARK                   677
 9 FRANCE                    676
10 UNITED KINGDOM            660
# ℹ 115 more rows</code></pre>
</div>
</div>
<p>125 countries</p>
</section>
<section id="aaer-dataset-aaer-is-a-binary-1-for-higher-likelihood-of-fraud-and-0-otherwise" class="level2">
<h2 class="anchored" data-anchor-id="aaer-dataset-aaer-is-a-binary-1-for-higher-likelihood-of-fraud-and-0-otherwise">1.2 AAER dataset AAER is a binary, 1 for higher likelihood of fraud and 0 otherwise</h2>
<p>AAER inner joined onto full data (AAER only includes US firms?? Since it is published by the SEC)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_aaer <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"C:/Users/rayne/Documents/y4s2/ACCT420_forensic_forecasting/banks_final_aaer.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>AAER has 42k observations, now we filter out banking industry to see how many observations are there from banking.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_aaer <span class="ot">&lt;-</span> df_aaer <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITEM6010 <span class="sc">==</span> <span class="dv">4</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(df_aaer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1 18941</code></pre>
</div>
</div>
<p>From 42k to 18941 observations</p>
<p>Seeing how many unique companies are in banking industry</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_aaer <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITEM6010 <span class="sc">==</span> <span class="dv">4</span>)<span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code)<span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()<span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  1262</code></pre>
</div>
</div>
<p>From 3053 banking companies (full dataset) to 1262 banking companies (AAER data)</p>
<p>Getting the countries that AAER data includes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df_aaer <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ITEM6026)<span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 39 × 2
   ITEM6026           n
   &lt;chr&gt;          &lt;int&gt;
 1 UNITED STATES  16839
 2 TURKEY           165
 3 AUSTRALIA        144
 4 ARGENTINA        135
 5 UNITED KINGDOM   106
 6 SOUTH AFRICA      94
 7 BRAZIL            93
 8 HONG KONG         88
 9 PUERTO RICO       88
10 SPAIN             85
# ℹ 29 more rows</code></pre>
</div>
</div>
<p>39 countries, most observations from the USA as expected</p>
<p>How many occurrences of AAER in relation to total observations per year?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df_aaer <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)<span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_AAERS =</span> <span class="fu">sum</span>(AAER<span class="sc">==</span><span class="dv">1</span>), <span class="at">total_observations=</span><span class="fu">n</span>(), <span class="at">percent_AAERS =</span> total_AAERS<span class="sc">/</span>total_observations)<span class="sc">|&gt;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, total_AAERS, total_observations, percent_AAERS)<span class="sc">|&gt;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)<span class="sc">|&gt;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 4
# Groups:   year [24]
    year total_AAERS total_observations percent_AAERS
   &lt;dbl&gt;       &lt;int&gt;              &lt;int&gt;         &lt;dbl&gt;
 1  2000          12                766        0.0157
 2  2001          11                822        0.0134
 3  2002          12                849        0.0141
 4  2003          12                877        0.0137
 5  2004          11                899        0.0122
 6  2005          17                919        0.0185
 7  2006          16                918        0.0174
 8  2007          19                910        0.0209
 9  2008          19                904        0.0210
10  2009          19                901        0.0211
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>215 occurrences of AAER in total out of 18941 total observations from 2000 to 2023 (2023 has 0 cases).</p>
<p>Takeaway from EDA:</p>
<ol type="1">
<li><p>The AAER dataset filters the original dataset from 162k rows to 18941 rows.</p></li>
<li><p>From 125 countries to 39 countries, mostly USA which makes sense since the AAER is published by the SEC.</p></li>
<li><p>From 3053 banking companies to 1262 banking companies.</p></li>
<li><p>Percent of AAER is very low each year, which makes sense since frauds are far and few between and companies which commit fraud tend to keep it well hidden.</p></li>
<li><p>As the years go by, the percent of AAER decreases, suggesting (just from this data) that there could be stricter regulations over time or companies got better at hiding.</p></li>
<li><p>0 cases in 2023 -&gt; suggestive that we have no data on it as it is still early 2024. We should filter out 2023.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_aaer <span class="ot">&lt;-</span> df_aaer <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="dv">2023</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="feature-engineering-and-more-eda" class="level1">
<h1>2. Feature engineering (and more EDA)</h1>
<p>2 papers have been referenced to inspire our model building process. The first one enlightens us on the raw accounting line items and financial ratios to use to predict AAER, second one breaks down the formulas behind each financial ratio, with which we could use raw accounting line items to to manually derive.</p>
<ol type="1">
<li><p>From the journal of accounting research: Detecting Accounting Fraud in Publicly Traded U.S. Firms Using a Machine Learning Approach (Bao at el, 2015)</p></li>
<li><p>Predicting Material Accounting Misstatements (Dechow et al, 2011)</p></li>
</ol>
<p>Additionally, based on our own text analysis and topic modelling, we realised that auditors play a huge role. Hence, aside from these well-researched accounting line items and financial ratios, we also have indicators for auditors.</p>
<section id="eda-on-18-raw-accounting-line-variables-model" class="level2">
<h2 class="anchored" data-anchor-id="eda-on-18-raw-accounting-line-variables-model">2.1 EDA on 18 raw accounting line variables model</h2>
<p>Selecting the 18 raw accounting line variables and convert to numeric</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df_aaer1 <span class="ot">&lt;-</span> df_aaer<span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ITEM7210 is the market cap, not part of the accounting line</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AAER, code, year, ITEM2001, ITEM2051, ITEM2101, ITEM2008, ITEM2201, ITEM2301, ITEM2999, ITEM3040, ITEM3063, ITEM3101, ITEM3251, ITEM3351, ITEM3501, ITEM3451, ITEM7240, ITEM8335, ITEM1551, ITEM3480, ITEM7210)<span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ITEM2999=</span><span class="fu">as.numeric</span>(ITEM2999), <span class="at">ITEM3351=</span><span class="fu">as.numeric</span>(ITEM3351))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_missing</span>(df_aaer1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We keep only the raw accounting line items that have more than 80% filled data (the yellow ITEMS). Those with too many NA values are not useful for our model. Hence, we are left with 8 accounting line items.</p>
</section>
<section id="eda-on-22-variable-model-8-accounting-line-12-financial-ratio-2-indicators-for-big4-auditor-and-auditors-opinion" class="level2">
<h2 class="anchored" data-anchor-id="eda-on-22-variable-model-8-accounting-line-12-financial-ratio-2-indicators-for-big4-auditor-and-auditors-opinion">2.2 EDA on 22 variable model (8 accounting line + 12 financial ratio + 2 indicators for big4 auditor and auditor’s opinion)</h2>
<p>Then, we add in 12 relevant financial ratios, auditor’s opinion and parent auditor (Big 4 indicator) variables to the 8 raw accounting line items filtered. Note: an extra variable is market cap (ITEM7210) not used in modelling but used in data imputation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_aaer1 <span class="ot">&lt;-</span> df_aaer <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AAER, code, year, ITEM3480, ITEM1551, ITEM7240, ITEM3501, ITEM3351, ITEM3251, ITEM2999, ITEM3451, ITEM7210, ITEM8201, ITEM8206, ITEM8216, ITEM8221, ITEM8301, ITEM8376, ITEM8366, ITEM8251, ITEM8256, ITEM8311, ITEM8656, ITEM8631, ITEM7546, ITEM7800) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ITEM2999=</span><span class="fu">as.numeric</span>(ITEM2999), <span class="at">ITEM3351=</span><span class="fu">as.numeric</span>(ITEM3351))<span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">common_stock=</span>ITEM3480, <span class="at">net_income_before_extraordinary_items=</span>ITEM1551, <span class="at">net_sales_or_revenues=</span>ITEM7240, <span class="at">common_equity=</span>ITEM3501, <span class="at">total_liabilities=</span>ITEM3351, <span class="at">long_term_debt=</span>ITEM3251, <span class="at">total_assets=</span>ITEM2999, <span class="at">preferred_stock=</span>ITEM3451, <span class="at">market_cap=</span>ITEM7210, <span class="at">equity_total_capital_ratio=</span>ITEM8201, <span class="at">preferred_stock_total_capital_ratio=</span>ITEM8206, <span class="at">long_term_debt_total_capital_ratio=</span>ITEM8216, <span class="at">total_debt_total_capital_ratio=</span>ITEM8221, <span class="at">total_percent_return_on_equity=</span>ITEM8301, <span class="at">return_on_invested_capital=</span>ITEM8376, <span class="at">net_margin=</span>ITEM8366, <span class="at">fixed_charge_coverage_ratio=</span>ITEM8251, <span class="at">divident_payout_percent_earnings_total_dollar=</span>ITEM8256, <span class="at">cash_flow_sales=</span>ITEM8311, <span class="at">total_reinvestment_rate=</span>ITEM8656, <span class="at">net_sales_over_revenues_growth=</span>ITEM8631, <span class="at">auditor_opinion=</span>ITEM7546, <span class="at">parent_auditor=</span>ITEM7800</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_missing</span>(df_aaer1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>All variables in our 22 variable model passes the 80% filled data test. Now it’s time to explore on their correlation in order to prevent multicollinearity in our modelling process.</p>
<p>Firstly, we need to convert auditor’s opinion and parent auditor to factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_aaer1 <span class="ot">&lt;-</span> df_aaer1<span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parent_auditor =</span> <span class="fu">case_when</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"KPMG|Deloitte|PricewaterhouseCoopers|Ernst &amp; Young"</span>, </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>          parent_auditor, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Big 4"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  ))<span class="sc">|&gt;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert Big 4 into factor, 1 if "Big 4", 0 if "Other"</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parent_auditor=</span><span class="fu">factor</span>(parent_auditor,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"Big 4"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))<span class="sc">|&gt;</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">auditor_opinion=</span><span class="fu">as.factor</span>(auditor_opinion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we take a look at the correlation matrix. We are trying to prevent multicollinearity in our model. If variables are correlated with one another, we will drop one of the two correlated variables, as part of pre-processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(df_aaer1 <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">plot_correlation</span>(<span class="at">maxcat=</span><span class="dv">16</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-99c27c4f7079a9be2957" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-99c27c4f7079a9be2957">{"x":{"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],"y":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],"z":[[1,0.617394990395147,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.49516505900158958,0.50483494099841042,0.50901005440451652,0.51044087846708031,0.45719996301982757,0.50947539988356405,0.53979628046932016,0.52721234875062106,0.47278765124937894],[0.617394990395147,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.52215384399561804,0.47784615600438196,0.48488438650576687,0.50541037828041924,0.39741799940839356,0.52169806198901258,0.60389926331773447,0.48607716686018593,0.51392283313981413],[null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null],[0.49516505900158958,0.52215384399561804,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,5.5511151231257827e-17,0.48914665964821608,0.50354473887476381,0.51043024099392609,0.50149914731781775,0.48979339767747077,0.50973261053175434,0.49026738946824566],[0.50483494099841042,0.47784615600438196,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,5.5511151231257827e-17,1,0.51085334035178387,0.49645526112523625,0.48956975900607391,0.4985008526821823,0.51020660232252923,0.49026738946824566,0.50973261053175434],[0.50901005440451652,0.48488438650576687,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.48914665964821608,0.51085334035178387,1,0.49872730585221964,0.44789943054854392,0.49946174991009051,0.4929146098490077,0.49365369418293226,0.50634630581706774],[0.51044087846708031,0.50541037828041924,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.50354473887476381,0.49645526112523625,0.49872730585221964,1,0.41292326916776612,0.49910041178641734,0.48815804476774149,0.4767857224603218,0.5232142775396782],[0.45719996301982757,0.39741799940839356,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.51043024099392609,0.48956975900607391,0.44789943054854392,0.41292326916776612,1,0.4631733529369842,0.015223188465709359,0.44633046399303278,0.55366953600696722],[0.50947539988356405,0.52169806198901258,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.50149914731781775,0.4985008526821823,0.49946174991009051,0.49910041178641734,0.4631733529369842,1,0.4949917790699489,0.48675846085305563,0.51324153914694437],[0.53979628046932016,0.60389926331773447,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.48979339767747077,0.51020660232252923,0.4929146098490077,0.48815804476774149,0.015223188465709359,0.4949917790699489,1,0.56155467712589413,0.43844532287410587],[0.52721234875062106,0.48607716686018593,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.50973261053175434,0.49026738946824566,0.49365369418293226,0.4767857224603218,0.44633046399303278,0.48675846085305563,0.56155467712589413,1,0],[0.47278765124937894,0.51392283313981413,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.49026738946824566,0.50973261053175434,0.50634630581706774,0.5232142775396782,0.55366953600696722,0.51324153914694437,0.43844532287410587,0,1]],"text":[["Var1: code<br />Var2: code<br />value:  1.000000000","Var1: year<br />Var2: code<br />value:  0.234789981","Var1: common_stock<br />Var2: code<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: code<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: code<br />value:           NA","Var1: common_equity<br />Var2: code<br />value:           NA","Var1: total_liabilities<br />Var2: code<br />value:           NA","Var1: long_term_debt<br />Var2: code<br />value:           NA","Var1: total_assets<br />Var2: code<br />value:           NA","Var1: preferred_stock<br />Var2: code<br />value:           NA","Var1: market_cap<br />Var2: code<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: code<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: code<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: code<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: code<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: code<br />value:           NA","Var1: return_on_invested_capital<br />Var2: code<br />value:           NA","Var1: net_margin<br />Var2: code<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: code<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: code<br />value:           NA","Var1: cash_flow_sales<br />Var2: code<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: code<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: code<br />value:           NA","Var1: AAER_0<br />Var2: code<br />value: -0.009669882","Var1: AAER_1<br />Var2: code<br />value:  0.009669882","Var1: auditor_opinion_1<br />Var2: code<br />value:  0.018020109","Var1: auditor_opinion_5<br />Var2: code<br />value:  0.020881757","Var1: auditor_opinion_6<br />Var2: code<br />value: -0.085600074","Var1: auditor_opinion_7<br />Var2: code<br />value:  0.018950800","Var1: auditor_opinion_NA<br />Var2: code<br />value:  0.079592561","Var1: parent_auditor_0<br />Var2: code<br />value:  0.054424698","Var1: parent_auditor_1<br />Var2: code<br />value: -0.054424698"],["Var1: code<br />Var2: year<br />value:  0.234789981","Var1: year<br />Var2: year<br />value:  1.000000000","Var1: common_stock<br />Var2: year<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: year<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: year<br />value:           NA","Var1: common_equity<br />Var2: year<br />value:           NA","Var1: total_liabilities<br />Var2: year<br />value:           NA","Var1: long_term_debt<br />Var2: year<br />value:           NA","Var1: total_assets<br />Var2: year<br />value:           NA","Var1: preferred_stock<br />Var2: year<br />value:           NA","Var1: market_cap<br />Var2: year<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: year<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: year<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: year<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: year<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: year<br />value:           NA","Var1: return_on_invested_capital<br />Var2: year<br />value:           NA","Var1: net_margin<br />Var2: year<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: year<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: year<br />value:           NA","Var1: cash_flow_sales<br />Var2: year<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: year<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: year<br />value:           NA","Var1: AAER_0<br />Var2: year<br />value:  0.044307688","Var1: AAER_1<br />Var2: year<br />value: -0.044307688","Var1: auditor_opinion_1<br />Var2: year<br />value: -0.030231227","Var1: auditor_opinion_5<br />Var2: year<br />value:  0.010820757","Var1: auditor_opinion_6<br />Var2: year<br />value: -0.205164001","Var1: auditor_opinion_7<br />Var2: year<br />value:  0.043396124","Var1: auditor_opinion_NA<br />Var2: year<br />value:  0.207798527","Var1: parent_auditor_0<br />Var2: year<br />value: -0.027845666","Var1: parent_auditor_1<br />Var2: year<br />value:  0.027845666"],["Var1: code<br />Var2: common_stock<br />value:           NA","Var1: year<br />Var2: common_stock<br />value:           NA","Var1: common_stock<br />Var2: common_stock<br />value:  1.000000000","Var1: net_income_before_extraordinary_items<br />Var2: common_stock<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: common_stock<br />value:           NA","Var1: common_equity<br />Var2: common_stock<br />value:           NA","Var1: total_liabilities<br />Var2: common_stock<br />value:           NA","Var1: long_term_debt<br />Var2: common_stock<br />value:           NA","Var1: total_assets<br />Var2: common_stock<br />value:           NA","Var1: preferred_stock<br />Var2: common_stock<br />value:           NA","Var1: market_cap<br />Var2: common_stock<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: common_stock<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: common_stock<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: common_stock<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: common_stock<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: common_stock<br />value:           NA","Var1: return_on_invested_capital<br />Var2: common_stock<br />value:           NA","Var1: net_margin<br />Var2: common_stock<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: common_stock<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: common_stock<br />value:           NA","Var1: cash_flow_sales<br />Var2: common_stock<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: common_stock<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: common_stock<br />value:           NA","Var1: AAER_0<br />Var2: common_stock<br />value:           NA","Var1: AAER_1<br />Var2: common_stock<br />value:           NA","Var1: auditor_opinion_1<br />Var2: common_stock<br />value:           NA","Var1: auditor_opinion_5<br />Var2: common_stock<br />value:           NA","Var1: auditor_opinion_6<br />Var2: common_stock<br />value:           NA","Var1: auditor_opinion_7<br />Var2: common_stock<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: common_stock<br />value:           NA","Var1: parent_auditor_0<br />Var2: common_stock<br />value:           NA","Var1: parent_auditor_1<br />Var2: common_stock<br />value:           NA"],["Var1: code<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: year<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: common_stock<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: net_income_before_extraordinary_items<br />value:  1.000000000","Var1: net_sales_or_revenues<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: common_equity<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: total_liabilities<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: long_term_debt<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: total_assets<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: preferred_stock<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: market_cap<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: return_on_invested_capital<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: net_margin<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: cash_flow_sales<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: AAER_0<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: AAER_1<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: auditor_opinion_1<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: auditor_opinion_5<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: auditor_opinion_6<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: auditor_opinion_7<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: parent_auditor_0<br />Var2: net_income_before_extraordinary_items<br />value:           NA","Var1: parent_auditor_1<br />Var2: net_income_before_extraordinary_items<br />value:           NA"],["Var1: code<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: year<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: common_stock<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: net_sales_or_revenues<br />value:  1.000000000","Var1: common_equity<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: total_liabilities<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: long_term_debt<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: total_assets<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: preferred_stock<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: market_cap<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: return_on_invested_capital<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: net_margin<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: cash_flow_sales<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: AAER_0<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: AAER_1<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: auditor_opinion_1<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: auditor_opinion_5<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: auditor_opinion_6<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: auditor_opinion_7<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: parent_auditor_0<br />Var2: net_sales_or_revenues<br />value:           NA","Var1: parent_auditor_1<br />Var2: net_sales_or_revenues<br />value:           NA"],["Var1: code<br />Var2: common_equity<br />value:           NA","Var1: year<br />Var2: common_equity<br />value:           NA","Var1: common_stock<br />Var2: common_equity<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: common_equity<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: common_equity<br />value:           NA","Var1: common_equity<br />Var2: common_equity<br />value:  1.000000000","Var1: total_liabilities<br />Var2: common_equity<br />value:           NA","Var1: long_term_debt<br />Var2: common_equity<br />value:           NA","Var1: total_assets<br />Var2: common_equity<br />value:           NA","Var1: preferred_stock<br />Var2: common_equity<br />value:           NA","Var1: market_cap<br />Var2: common_equity<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: common_equity<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: common_equity<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: common_equity<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: common_equity<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: common_equity<br />value:           NA","Var1: return_on_invested_capital<br />Var2: common_equity<br />value:           NA","Var1: net_margin<br />Var2: common_equity<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: common_equity<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: common_equity<br />value:           NA","Var1: cash_flow_sales<br />Var2: common_equity<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: common_equity<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: common_equity<br />value:           NA","Var1: AAER_0<br />Var2: common_equity<br />value:           NA","Var1: AAER_1<br />Var2: common_equity<br />value:           NA","Var1: auditor_opinion_1<br />Var2: common_equity<br />value:           NA","Var1: auditor_opinion_5<br />Var2: common_equity<br />value:           NA","Var1: auditor_opinion_6<br />Var2: common_equity<br />value:           NA","Var1: auditor_opinion_7<br />Var2: common_equity<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: common_equity<br />value:           NA","Var1: parent_auditor_0<br />Var2: common_equity<br />value:           NA","Var1: parent_auditor_1<br />Var2: common_equity<br />value:           NA"],["Var1: code<br />Var2: total_liabilities<br />value:           NA","Var1: year<br />Var2: total_liabilities<br />value:           NA","Var1: common_stock<br />Var2: total_liabilities<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: total_liabilities<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: total_liabilities<br />value:           NA","Var1: common_equity<br />Var2: total_liabilities<br />value:           NA","Var1: total_liabilities<br />Var2: total_liabilities<br />value:  1.000000000","Var1: long_term_debt<br />Var2: total_liabilities<br />value:           NA","Var1: total_assets<br />Var2: total_liabilities<br />value:           NA","Var1: preferred_stock<br />Var2: total_liabilities<br />value:           NA","Var1: market_cap<br />Var2: total_liabilities<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: total_liabilities<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: total_liabilities<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: total_liabilities<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: total_liabilities<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: total_liabilities<br />value:           NA","Var1: return_on_invested_capital<br />Var2: total_liabilities<br />value:           NA","Var1: net_margin<br />Var2: total_liabilities<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: total_liabilities<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: total_liabilities<br />value:           NA","Var1: cash_flow_sales<br />Var2: total_liabilities<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: total_liabilities<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: total_liabilities<br />value:           NA","Var1: AAER_0<br />Var2: total_liabilities<br />value:           NA","Var1: AAER_1<br />Var2: total_liabilities<br />value:           NA","Var1: auditor_opinion_1<br />Var2: total_liabilities<br />value:           NA","Var1: auditor_opinion_5<br />Var2: total_liabilities<br />value:           NA","Var1: auditor_opinion_6<br />Var2: total_liabilities<br />value:           NA","Var1: auditor_opinion_7<br />Var2: total_liabilities<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: total_liabilities<br />value:           NA","Var1: parent_auditor_0<br />Var2: total_liabilities<br />value:           NA","Var1: parent_auditor_1<br />Var2: total_liabilities<br />value:           NA"],["Var1: code<br />Var2: long_term_debt<br />value:           NA","Var1: year<br />Var2: long_term_debt<br />value:           NA","Var1: common_stock<br />Var2: long_term_debt<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: long_term_debt<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: long_term_debt<br />value:           NA","Var1: common_equity<br />Var2: long_term_debt<br />value:           NA","Var1: total_liabilities<br />Var2: long_term_debt<br />value:           NA","Var1: long_term_debt<br />Var2: long_term_debt<br />value:  1.000000000","Var1: total_assets<br />Var2: long_term_debt<br />value:           NA","Var1: preferred_stock<br />Var2: long_term_debt<br />value:           NA","Var1: market_cap<br />Var2: long_term_debt<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: long_term_debt<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: long_term_debt<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: long_term_debt<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: long_term_debt<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: long_term_debt<br />value:           NA","Var1: return_on_invested_capital<br />Var2: long_term_debt<br />value:           NA","Var1: net_margin<br />Var2: long_term_debt<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: long_term_debt<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: long_term_debt<br />value:           NA","Var1: cash_flow_sales<br />Var2: long_term_debt<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: long_term_debt<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: long_term_debt<br />value:           NA","Var1: AAER_0<br />Var2: long_term_debt<br />value:           NA","Var1: AAER_1<br />Var2: long_term_debt<br />value:           NA","Var1: auditor_opinion_1<br />Var2: long_term_debt<br />value:           NA","Var1: auditor_opinion_5<br />Var2: long_term_debt<br />value:           NA","Var1: auditor_opinion_6<br />Var2: long_term_debt<br />value:           NA","Var1: auditor_opinion_7<br />Var2: long_term_debt<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: long_term_debt<br />value:           NA","Var1: parent_auditor_0<br />Var2: long_term_debt<br />value:           NA","Var1: parent_auditor_1<br />Var2: long_term_debt<br />value:           NA"],["Var1: code<br />Var2: total_assets<br />value:           NA","Var1: year<br />Var2: total_assets<br />value:           NA","Var1: common_stock<br />Var2: total_assets<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: total_assets<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: total_assets<br />value:           NA","Var1: common_equity<br />Var2: total_assets<br />value:           NA","Var1: total_liabilities<br />Var2: total_assets<br />value:           NA","Var1: long_term_debt<br />Var2: total_assets<br />value:           NA","Var1: total_assets<br />Var2: total_assets<br />value:  1.000000000","Var1: preferred_stock<br />Var2: total_assets<br />value:           NA","Var1: market_cap<br />Var2: total_assets<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: total_assets<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: total_assets<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: total_assets<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: total_assets<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: total_assets<br />value:           NA","Var1: return_on_invested_capital<br />Var2: total_assets<br />value:           NA","Var1: net_margin<br />Var2: total_assets<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: total_assets<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: total_assets<br />value:           NA","Var1: cash_flow_sales<br />Var2: total_assets<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: total_assets<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: total_assets<br />value:           NA","Var1: AAER_0<br />Var2: total_assets<br />value:           NA","Var1: AAER_1<br />Var2: total_assets<br />value:           NA","Var1: auditor_opinion_1<br />Var2: total_assets<br />value:           NA","Var1: auditor_opinion_5<br />Var2: total_assets<br />value:           NA","Var1: auditor_opinion_6<br />Var2: total_assets<br />value:           NA","Var1: auditor_opinion_7<br />Var2: total_assets<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: total_assets<br />value:           NA","Var1: parent_auditor_0<br />Var2: total_assets<br />value:           NA","Var1: parent_auditor_1<br />Var2: total_assets<br />value:           NA"],["Var1: code<br />Var2: preferred_stock<br />value:           NA","Var1: year<br />Var2: preferred_stock<br />value:           NA","Var1: common_stock<br />Var2: preferred_stock<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: preferred_stock<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: preferred_stock<br />value:           NA","Var1: common_equity<br />Var2: preferred_stock<br />value:           NA","Var1: total_liabilities<br />Var2: preferred_stock<br />value:           NA","Var1: long_term_debt<br />Var2: preferred_stock<br />value:           NA","Var1: total_assets<br />Var2: preferred_stock<br />value:           NA","Var1: preferred_stock<br />Var2: preferred_stock<br />value:  1.000000000","Var1: market_cap<br />Var2: preferred_stock<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: preferred_stock<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: preferred_stock<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: preferred_stock<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: preferred_stock<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: preferred_stock<br />value:           NA","Var1: return_on_invested_capital<br />Var2: preferred_stock<br />value:           NA","Var1: net_margin<br />Var2: preferred_stock<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: preferred_stock<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: preferred_stock<br />value:           NA","Var1: cash_flow_sales<br />Var2: preferred_stock<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: preferred_stock<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: preferred_stock<br />value:           NA","Var1: AAER_0<br />Var2: preferred_stock<br />value:           NA","Var1: AAER_1<br />Var2: preferred_stock<br />value:           NA","Var1: auditor_opinion_1<br />Var2: preferred_stock<br />value:           NA","Var1: auditor_opinion_5<br />Var2: preferred_stock<br />value:           NA","Var1: auditor_opinion_6<br />Var2: preferred_stock<br />value:           NA","Var1: auditor_opinion_7<br />Var2: preferred_stock<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: preferred_stock<br />value:           NA","Var1: parent_auditor_0<br />Var2: preferred_stock<br />value:           NA","Var1: parent_auditor_1<br />Var2: preferred_stock<br />value:           NA"],["Var1: code<br />Var2: market_cap<br />value:           NA","Var1: year<br />Var2: market_cap<br />value:           NA","Var1: common_stock<br />Var2: market_cap<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: market_cap<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: market_cap<br />value:           NA","Var1: common_equity<br />Var2: market_cap<br />value:           NA","Var1: total_liabilities<br />Var2: market_cap<br />value:           NA","Var1: long_term_debt<br />Var2: market_cap<br />value:           NA","Var1: total_assets<br />Var2: market_cap<br />value:           NA","Var1: preferred_stock<br />Var2: market_cap<br />value:           NA","Var1: market_cap<br />Var2: market_cap<br />value:  1.000000000","Var1: equity_total_capital_ratio<br />Var2: market_cap<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: market_cap<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: market_cap<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: market_cap<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: market_cap<br />value:           NA","Var1: return_on_invested_capital<br />Var2: market_cap<br />value:           NA","Var1: net_margin<br />Var2: market_cap<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: market_cap<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: market_cap<br />value:           NA","Var1: cash_flow_sales<br />Var2: market_cap<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: market_cap<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: market_cap<br />value:           NA","Var1: AAER_0<br />Var2: market_cap<br />value:           NA","Var1: AAER_1<br />Var2: market_cap<br />value:           NA","Var1: auditor_opinion_1<br />Var2: market_cap<br />value:           NA","Var1: auditor_opinion_5<br />Var2: market_cap<br />value:           NA","Var1: auditor_opinion_6<br />Var2: market_cap<br />value:           NA","Var1: auditor_opinion_7<br />Var2: market_cap<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: market_cap<br />value:           NA","Var1: parent_auditor_0<br />Var2: market_cap<br />value:           NA","Var1: parent_auditor_1<br />Var2: market_cap<br />value:           NA"],["Var1: code<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: year<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: common_stock<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: common_equity<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: total_liabilities<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: long_term_debt<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: total_assets<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: preferred_stock<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: market_cap<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: equity_total_capital_ratio<br />value:  1.000000000","Var1: preferred_stock_total_capital_ratio<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: return_on_invested_capital<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: net_margin<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: cash_flow_sales<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: AAER_0<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: AAER_1<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_1<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_5<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_6<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_7<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: parent_auditor_0<br />Var2: equity_total_capital_ratio<br />value:           NA","Var1: parent_auditor_1<br />Var2: equity_total_capital_ratio<br />value:           NA"],["Var1: code<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: year<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: common_stock<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: common_equity<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: total_liabilities<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: long_term_debt<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: total_assets<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: preferred_stock<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: market_cap<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: preferred_stock_total_capital_ratio<br />value:  1.000000000","Var1: long_term_debt_total_capital_ratio<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: return_on_invested_capital<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: net_margin<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: cash_flow_sales<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: AAER_0<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: AAER_1<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_1<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_5<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_6<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_7<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: parent_auditor_0<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA","Var1: parent_auditor_1<br />Var2: preferred_stock_total_capital_ratio<br />value:           NA"],["Var1: code<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: year<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: common_stock<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: common_equity<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: total_liabilities<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: long_term_debt<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: total_assets<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: preferred_stock<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: market_cap<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: long_term_debt_total_capital_ratio<br />value:  1.000000000","Var1: total_debt_total_capital_ratio<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: return_on_invested_capital<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: net_margin<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: cash_flow_sales<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: AAER_0<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: AAER_1<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_1<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_5<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_6<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_7<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: parent_auditor_0<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA","Var1: parent_auditor_1<br />Var2: long_term_debt_total_capital_ratio<br />value:           NA"],["Var1: code<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: year<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: common_stock<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: common_equity<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: total_liabilities<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: long_term_debt<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: total_assets<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: preferred_stock<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: market_cap<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: total_debt_total_capital_ratio<br />value:  1.000000000","Var1: total_percent_return_on_equity<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: return_on_invested_capital<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: net_margin<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: cash_flow_sales<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: AAER_0<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: AAER_1<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_1<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_5<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_6<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_7<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: parent_auditor_0<br />Var2: total_debt_total_capital_ratio<br />value:           NA","Var1: parent_auditor_1<br />Var2: total_debt_total_capital_ratio<br />value:           NA"],["Var1: code<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: year<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: common_stock<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: common_equity<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: total_liabilities<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: long_term_debt<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: total_assets<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: preferred_stock<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: market_cap<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: total_percent_return_on_equity<br />value:  1.000000000","Var1: return_on_invested_capital<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: net_margin<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: cash_flow_sales<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: AAER_0<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: AAER_1<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: auditor_opinion_1<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: auditor_opinion_5<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: auditor_opinion_6<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: auditor_opinion_7<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: parent_auditor_0<br />Var2: total_percent_return_on_equity<br />value:           NA","Var1: parent_auditor_1<br />Var2: total_percent_return_on_equity<br />value:           NA"],["Var1: code<br />Var2: return_on_invested_capital<br />value:           NA","Var1: year<br />Var2: return_on_invested_capital<br />value:           NA","Var1: common_stock<br />Var2: return_on_invested_capital<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: return_on_invested_capital<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: return_on_invested_capital<br />value:           NA","Var1: common_equity<br />Var2: return_on_invested_capital<br />value:           NA","Var1: total_liabilities<br />Var2: return_on_invested_capital<br />value:           NA","Var1: long_term_debt<br />Var2: return_on_invested_capital<br />value:           NA","Var1: total_assets<br />Var2: return_on_invested_capital<br />value:           NA","Var1: preferred_stock<br />Var2: return_on_invested_capital<br />value:           NA","Var1: market_cap<br />Var2: return_on_invested_capital<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: return_on_invested_capital<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: return_on_invested_capital<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: return_on_invested_capital<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: return_on_invested_capital<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: return_on_invested_capital<br />value:           NA","Var1: return_on_invested_capital<br />Var2: return_on_invested_capital<br />value:  1.000000000","Var1: net_margin<br />Var2: return_on_invested_capital<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: return_on_invested_capital<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: return_on_invested_capital<br />value:           NA","Var1: cash_flow_sales<br />Var2: return_on_invested_capital<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: return_on_invested_capital<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: return_on_invested_capital<br />value:           NA","Var1: AAER_0<br />Var2: return_on_invested_capital<br />value:           NA","Var1: AAER_1<br />Var2: return_on_invested_capital<br />value:           NA","Var1: auditor_opinion_1<br />Var2: return_on_invested_capital<br />value:           NA","Var1: auditor_opinion_5<br />Var2: return_on_invested_capital<br />value:           NA","Var1: auditor_opinion_6<br />Var2: return_on_invested_capital<br />value:           NA","Var1: auditor_opinion_7<br />Var2: return_on_invested_capital<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: return_on_invested_capital<br />value:           NA","Var1: parent_auditor_0<br />Var2: return_on_invested_capital<br />value:           NA","Var1: parent_auditor_1<br />Var2: return_on_invested_capital<br />value:           NA"],["Var1: code<br />Var2: net_margin<br />value:           NA","Var1: year<br />Var2: net_margin<br />value:           NA","Var1: common_stock<br />Var2: net_margin<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: net_margin<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: net_margin<br />value:           NA","Var1: common_equity<br />Var2: net_margin<br />value:           NA","Var1: total_liabilities<br />Var2: net_margin<br />value:           NA","Var1: long_term_debt<br />Var2: net_margin<br />value:           NA","Var1: total_assets<br />Var2: net_margin<br />value:           NA","Var1: preferred_stock<br />Var2: net_margin<br />value:           NA","Var1: market_cap<br />Var2: net_margin<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: net_margin<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: net_margin<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: net_margin<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: net_margin<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: net_margin<br />value:           NA","Var1: return_on_invested_capital<br />Var2: net_margin<br />value:           NA","Var1: net_margin<br />Var2: net_margin<br />value:  1.000000000","Var1: fixed_charge_coverage_ratio<br />Var2: net_margin<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: net_margin<br />value:           NA","Var1: cash_flow_sales<br />Var2: net_margin<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: net_margin<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: net_margin<br />value:           NA","Var1: AAER_0<br />Var2: net_margin<br />value:           NA","Var1: AAER_1<br />Var2: net_margin<br />value:           NA","Var1: auditor_opinion_1<br />Var2: net_margin<br />value:           NA","Var1: auditor_opinion_5<br />Var2: net_margin<br />value:           NA","Var1: auditor_opinion_6<br />Var2: net_margin<br />value:           NA","Var1: auditor_opinion_7<br />Var2: net_margin<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: net_margin<br />value:           NA","Var1: parent_auditor_0<br />Var2: net_margin<br />value:           NA","Var1: parent_auditor_1<br />Var2: net_margin<br />value:           NA"],["Var1: code<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: year<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: common_stock<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: common_equity<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: total_liabilities<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: long_term_debt<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: total_assets<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: preferred_stock<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: market_cap<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: return_on_invested_capital<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: net_margin<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: fixed_charge_coverage_ratio<br />value:  1.000000000","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: cash_flow_sales<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: AAER_0<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: AAER_1<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: auditor_opinion_1<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: auditor_opinion_5<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: auditor_opinion_6<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: auditor_opinion_7<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: parent_auditor_0<br />Var2: fixed_charge_coverage_ratio<br />value:           NA","Var1: parent_auditor_1<br />Var2: fixed_charge_coverage_ratio<br />value:           NA"],["Var1: code<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: year<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: common_stock<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: common_equity<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: total_liabilities<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: long_term_debt<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: total_assets<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: preferred_stock<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: market_cap<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: return_on_invested_capital<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: net_margin<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:  1.000000000","Var1: cash_flow_sales<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: AAER_0<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: AAER_1<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: auditor_opinion_1<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: auditor_opinion_5<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: auditor_opinion_6<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: auditor_opinion_7<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: parent_auditor_0<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA","Var1: parent_auditor_1<br />Var2: divident_payout_percent_earnings_total_dollar<br />value:           NA"],["Var1: code<br />Var2: cash_flow_sales<br />value:           NA","Var1: year<br />Var2: cash_flow_sales<br />value:           NA","Var1: common_stock<br />Var2: cash_flow_sales<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: cash_flow_sales<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: cash_flow_sales<br />value:           NA","Var1: common_equity<br />Var2: cash_flow_sales<br />value:           NA","Var1: total_liabilities<br />Var2: cash_flow_sales<br />value:           NA","Var1: long_term_debt<br />Var2: cash_flow_sales<br />value:           NA","Var1: total_assets<br />Var2: cash_flow_sales<br />value:           NA","Var1: preferred_stock<br />Var2: cash_flow_sales<br />value:           NA","Var1: market_cap<br />Var2: cash_flow_sales<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: cash_flow_sales<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: cash_flow_sales<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: cash_flow_sales<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: cash_flow_sales<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: cash_flow_sales<br />value:           NA","Var1: return_on_invested_capital<br />Var2: cash_flow_sales<br />value:           NA","Var1: net_margin<br />Var2: cash_flow_sales<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: cash_flow_sales<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: cash_flow_sales<br />value:           NA","Var1: cash_flow_sales<br />Var2: cash_flow_sales<br />value:  1.000000000","Var1: total_reinvestment_rate<br />Var2: cash_flow_sales<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: cash_flow_sales<br />value:           NA","Var1: AAER_0<br />Var2: cash_flow_sales<br />value:           NA","Var1: AAER_1<br />Var2: cash_flow_sales<br />value:           NA","Var1: auditor_opinion_1<br />Var2: cash_flow_sales<br />value:           NA","Var1: auditor_opinion_5<br />Var2: cash_flow_sales<br />value:           NA","Var1: auditor_opinion_6<br />Var2: cash_flow_sales<br />value:           NA","Var1: auditor_opinion_7<br />Var2: cash_flow_sales<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: cash_flow_sales<br />value:           NA","Var1: parent_auditor_0<br />Var2: cash_flow_sales<br />value:           NA","Var1: parent_auditor_1<br />Var2: cash_flow_sales<br />value:           NA"],["Var1: code<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: year<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: common_stock<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: common_equity<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: total_liabilities<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: long_term_debt<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: total_assets<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: preferred_stock<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: market_cap<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: return_on_invested_capital<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: net_margin<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: cash_flow_sales<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: total_reinvestment_rate<br />value:  1.000000000","Var1: net_sales_over_revenues_growth<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: AAER_0<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: AAER_1<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: auditor_opinion_1<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: auditor_opinion_5<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: auditor_opinion_6<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: auditor_opinion_7<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: parent_auditor_0<br />Var2: total_reinvestment_rate<br />value:           NA","Var1: parent_auditor_1<br />Var2: total_reinvestment_rate<br />value:           NA"],["Var1: code<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: year<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: common_stock<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: common_equity<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: total_liabilities<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: long_term_debt<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: total_assets<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: preferred_stock<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: market_cap<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: return_on_invested_capital<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: net_margin<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: cash_flow_sales<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: net_sales_over_revenues_growth<br />value:  1.000000000","Var1: AAER_0<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: AAER_1<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: auditor_opinion_1<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: auditor_opinion_5<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: auditor_opinion_6<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: auditor_opinion_7<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: auditor_opinion_NA<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: parent_auditor_0<br />Var2: net_sales_over_revenues_growth<br />value:           NA","Var1: parent_auditor_1<br />Var2: net_sales_over_revenues_growth<br />value:           NA"],["Var1: code<br />Var2: AAER_0<br />value: -0.009669882","Var1: year<br />Var2: AAER_0<br />value:  0.044307688","Var1: common_stock<br />Var2: AAER_0<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: AAER_0<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: AAER_0<br />value:           NA","Var1: common_equity<br />Var2: AAER_0<br />value:           NA","Var1: total_liabilities<br />Var2: AAER_0<br />value:           NA","Var1: long_term_debt<br />Var2: AAER_0<br />value:           NA","Var1: total_assets<br />Var2: AAER_0<br />value:           NA","Var1: preferred_stock<br />Var2: AAER_0<br />value:           NA","Var1: market_cap<br />Var2: AAER_0<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: AAER_0<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: AAER_0<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: AAER_0<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: AAER_0<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: AAER_0<br />value:           NA","Var1: return_on_invested_capital<br />Var2: AAER_0<br />value:           NA","Var1: net_margin<br />Var2: AAER_0<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: AAER_0<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: AAER_0<br />value:           NA","Var1: cash_flow_sales<br />Var2: AAER_0<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: AAER_0<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: AAER_0<br />value:           NA","Var1: AAER_0<br />Var2: AAER_0<br />value:  1.000000000","Var1: AAER_1<br />Var2: AAER_0<br />value: -1.000000000","Var1: auditor_opinion_1<br />Var2: AAER_0<br />value: -0.021706681","Var1: auditor_opinion_5<br />Var2: AAER_0<br />value:  0.007089478","Var1: auditor_opinion_6<br />Var2: AAER_0<br />value:  0.020860482","Var1: auditor_opinion_7<br />Var2: AAER_0<br />value:  0.002998295","Var1: auditor_opinion_NA<br />Var2: AAER_0<br />value: -0.020413205","Var1: parent_auditor_0<br />Var2: AAER_0<br />value:  0.019465221","Var1: parent_auditor_1<br />Var2: AAER_0<br />value: -0.019465221"],["Var1: code<br />Var2: AAER_1<br />value:  0.009669882","Var1: year<br />Var2: AAER_1<br />value: -0.044307688","Var1: common_stock<br />Var2: AAER_1<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: AAER_1<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: AAER_1<br />value:           NA","Var1: common_equity<br />Var2: AAER_1<br />value:           NA","Var1: total_liabilities<br />Var2: AAER_1<br />value:           NA","Var1: long_term_debt<br />Var2: AAER_1<br />value:           NA","Var1: total_assets<br />Var2: AAER_1<br />value:           NA","Var1: preferred_stock<br />Var2: AAER_1<br />value:           NA","Var1: market_cap<br />Var2: AAER_1<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: AAER_1<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: AAER_1<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: AAER_1<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: AAER_1<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: AAER_1<br />value:           NA","Var1: return_on_invested_capital<br />Var2: AAER_1<br />value:           NA","Var1: net_margin<br />Var2: AAER_1<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: AAER_1<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: AAER_1<br />value:           NA","Var1: cash_flow_sales<br />Var2: AAER_1<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: AAER_1<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: AAER_1<br />value:           NA","Var1: AAER_0<br />Var2: AAER_1<br />value: -1.000000000","Var1: AAER_1<br />Var2: AAER_1<br />value:  1.000000000","Var1: auditor_opinion_1<br />Var2: AAER_1<br />value:  0.021706681","Var1: auditor_opinion_5<br />Var2: AAER_1<br />value: -0.007089478","Var1: auditor_opinion_6<br />Var2: AAER_1<br />value: -0.020860482","Var1: auditor_opinion_7<br />Var2: AAER_1<br />value: -0.002998295","Var1: auditor_opinion_NA<br />Var2: AAER_1<br />value:  0.020413205","Var1: parent_auditor_0<br />Var2: AAER_1<br />value: -0.019465221","Var1: parent_auditor_1<br />Var2: AAER_1<br />value:  0.019465221"],["Var1: code<br />Var2: auditor_opinion_1<br />value:  0.018020109","Var1: year<br />Var2: auditor_opinion_1<br />value: -0.030231227","Var1: common_stock<br />Var2: auditor_opinion_1<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: auditor_opinion_1<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: auditor_opinion_1<br />value:           NA","Var1: common_equity<br />Var2: auditor_opinion_1<br />value:           NA","Var1: total_liabilities<br />Var2: auditor_opinion_1<br />value:           NA","Var1: long_term_debt<br />Var2: auditor_opinion_1<br />value:           NA","Var1: total_assets<br />Var2: auditor_opinion_1<br />value:           NA","Var1: preferred_stock<br />Var2: auditor_opinion_1<br />value:           NA","Var1: market_cap<br />Var2: auditor_opinion_1<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: auditor_opinion_1<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: auditor_opinion_1<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: auditor_opinion_1<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: auditor_opinion_1<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: auditor_opinion_1<br />value:           NA","Var1: return_on_invested_capital<br />Var2: auditor_opinion_1<br />value:           NA","Var1: net_margin<br />Var2: auditor_opinion_1<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: auditor_opinion_1<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: auditor_opinion_1<br />value:           NA","Var1: cash_flow_sales<br />Var2: auditor_opinion_1<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: auditor_opinion_1<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: auditor_opinion_1<br />value:           NA","Var1: AAER_0<br />Var2: auditor_opinion_1<br />value: -0.021706681","Var1: AAER_1<br />Var2: auditor_opinion_1<br />value:  0.021706681","Var1: auditor_opinion_1<br />Var2: auditor_opinion_1<br />value:  1.000000000","Var1: auditor_opinion_5<br />Var2: auditor_opinion_1<br />value: -0.002545388","Var1: auditor_opinion_6<br />Var2: auditor_opinion_1<br />value: -0.104201139","Var1: auditor_opinion_7<br />Var2: auditor_opinion_1<br />value: -0.001076500","Var1: auditor_opinion_NA<br />Var2: auditor_opinion_1<br />value: -0.014170780","Var1: parent_auditor_0<br />Var2: auditor_opinion_1<br />value: -0.012692612","Var1: parent_auditor_1<br />Var2: auditor_opinion_1<br />value:  0.012692612"],["Var1: code<br />Var2: auditor_opinion_5<br />value:  0.020881757","Var1: year<br />Var2: auditor_opinion_5<br />value:  0.010820757","Var1: common_stock<br />Var2: auditor_opinion_5<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: auditor_opinion_5<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: auditor_opinion_5<br />value:           NA","Var1: common_equity<br />Var2: auditor_opinion_5<br />value:           NA","Var1: total_liabilities<br />Var2: auditor_opinion_5<br />value:           NA","Var1: long_term_debt<br />Var2: auditor_opinion_5<br />value:           NA","Var1: total_assets<br />Var2: auditor_opinion_5<br />value:           NA","Var1: preferred_stock<br />Var2: auditor_opinion_5<br />value:           NA","Var1: market_cap<br />Var2: auditor_opinion_5<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: auditor_opinion_5<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: auditor_opinion_5<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: auditor_opinion_5<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: auditor_opinion_5<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: auditor_opinion_5<br />value:           NA","Var1: return_on_invested_capital<br />Var2: auditor_opinion_5<br />value:           NA","Var1: net_margin<br />Var2: auditor_opinion_5<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: auditor_opinion_5<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: auditor_opinion_5<br />value:           NA","Var1: cash_flow_sales<br />Var2: auditor_opinion_5<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: auditor_opinion_5<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: auditor_opinion_5<br />value:           NA","Var1: AAER_0<br />Var2: auditor_opinion_5<br />value:  0.007089478","Var1: AAER_1<br />Var2: auditor_opinion_5<br />value: -0.007089478","Var1: auditor_opinion_1<br />Var2: auditor_opinion_5<br />value: -0.002545388","Var1: auditor_opinion_5<br />Var2: auditor_opinion_5<br />value:  1.000000000","Var1: auditor_opinion_6<br />Var2: auditor_opinion_5<br />value: -0.174153462","Var1: auditor_opinion_7<br />Var2: auditor_opinion_5<br />value: -0.001799176","Var1: auditor_opinion_NA<br />Var2: auditor_opinion_5<br />value: -0.023683910","Var1: parent_auditor_0<br />Var2: auditor_opinion_5<br />value: -0.046428555","Var1: parent_auditor_1<br />Var2: auditor_opinion_5<br />value:  0.046428555"],["Var1: code<br />Var2: auditor_opinion_6<br />value: -0.085600074","Var1: year<br />Var2: auditor_opinion_6<br />value: -0.205164001","Var1: common_stock<br />Var2: auditor_opinion_6<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: auditor_opinion_6<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: auditor_opinion_6<br />value:           NA","Var1: common_equity<br />Var2: auditor_opinion_6<br />value:           NA","Var1: total_liabilities<br />Var2: auditor_opinion_6<br />value:           NA","Var1: long_term_debt<br />Var2: auditor_opinion_6<br />value:           NA","Var1: total_assets<br />Var2: auditor_opinion_6<br />value:           NA","Var1: preferred_stock<br />Var2: auditor_opinion_6<br />value:           NA","Var1: market_cap<br />Var2: auditor_opinion_6<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: auditor_opinion_6<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: auditor_opinion_6<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: auditor_opinion_6<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: auditor_opinion_6<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: auditor_opinion_6<br />value:           NA","Var1: return_on_invested_capital<br />Var2: auditor_opinion_6<br />value:           NA","Var1: net_margin<br />Var2: auditor_opinion_6<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: auditor_opinion_6<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: auditor_opinion_6<br />value:           NA","Var1: cash_flow_sales<br />Var2: auditor_opinion_6<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: auditor_opinion_6<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: auditor_opinion_6<br />value:           NA","Var1: AAER_0<br />Var2: auditor_opinion_6<br />value:  0.020860482","Var1: AAER_1<br />Var2: auditor_opinion_6<br />value: -0.020860482","Var1: auditor_opinion_1<br />Var2: auditor_opinion_6<br />value: -0.104201139","Var1: auditor_opinion_5<br />Var2: auditor_opinion_6<br />value: -0.174153462","Var1: auditor_opinion_6<br />Var2: auditor_opinion_6<br />value:  1.000000000","Var1: auditor_opinion_7<br />Var2: auditor_opinion_6<br />value: -0.073653294","Var1: auditor_opinion_NA<br />Var2: auditor_opinion_6<br />value: -0.969553623","Var1: parent_auditor_0<br />Var2: auditor_opinion_6<br />value: -0.107339072","Var1: parent_auditor_1<br />Var2: auditor_opinion_6<br />value:  0.107339072"],["Var1: code<br />Var2: auditor_opinion_7<br />value:  0.018950800","Var1: year<br />Var2: auditor_opinion_7<br />value:  0.043396124","Var1: common_stock<br />Var2: auditor_opinion_7<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: auditor_opinion_7<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: auditor_opinion_7<br />value:           NA","Var1: common_equity<br />Var2: auditor_opinion_7<br />value:           NA","Var1: total_liabilities<br />Var2: auditor_opinion_7<br />value:           NA","Var1: long_term_debt<br />Var2: auditor_opinion_7<br />value:           NA","Var1: total_assets<br />Var2: auditor_opinion_7<br />value:           NA","Var1: preferred_stock<br />Var2: auditor_opinion_7<br />value:           NA","Var1: market_cap<br />Var2: auditor_opinion_7<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: auditor_opinion_7<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: auditor_opinion_7<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: auditor_opinion_7<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: auditor_opinion_7<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: auditor_opinion_7<br />value:           NA","Var1: return_on_invested_capital<br />Var2: auditor_opinion_7<br />value:           NA","Var1: net_margin<br />Var2: auditor_opinion_7<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: auditor_opinion_7<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: auditor_opinion_7<br />value:           NA","Var1: cash_flow_sales<br />Var2: auditor_opinion_7<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: auditor_opinion_7<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: auditor_opinion_7<br />value:           NA","Var1: AAER_0<br />Var2: auditor_opinion_7<br />value:  0.002998295","Var1: AAER_1<br />Var2: auditor_opinion_7<br />value: -0.002998295","Var1: auditor_opinion_1<br />Var2: auditor_opinion_7<br />value: -0.001076500","Var1: auditor_opinion_5<br />Var2: auditor_opinion_7<br />value: -0.001799176","Var1: auditor_opinion_6<br />Var2: auditor_opinion_7<br />value: -0.073653294","Var1: auditor_opinion_7<br />Var2: auditor_opinion_7<br />value:  1.000000000","Var1: auditor_opinion_NA<br />Var2: auditor_opinion_7<br />value: -0.010016442","Var1: parent_auditor_0<br />Var2: auditor_opinion_7<br />value: -0.026483078","Var1: parent_auditor_1<br />Var2: auditor_opinion_7<br />value:  0.026483078"],["Var1: code<br />Var2: auditor_opinion_NA<br />value:  0.079592561","Var1: year<br />Var2: auditor_opinion_NA<br />value:  0.207798527","Var1: common_stock<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: common_equity<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: total_liabilities<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: long_term_debt<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: total_assets<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: preferred_stock<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: market_cap<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: return_on_invested_capital<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: net_margin<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: cash_flow_sales<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: auditor_opinion_NA<br />value:           NA","Var1: AAER_0<br />Var2: auditor_opinion_NA<br />value: -0.020413205","Var1: AAER_1<br />Var2: auditor_opinion_NA<br />value:  0.020413205","Var1: auditor_opinion_1<br />Var2: auditor_opinion_NA<br />value: -0.014170780","Var1: auditor_opinion_5<br />Var2: auditor_opinion_NA<br />value: -0.023683910","Var1: auditor_opinion_6<br />Var2: auditor_opinion_NA<br />value: -0.969553623","Var1: auditor_opinion_7<br />Var2: auditor_opinion_NA<br />value: -0.010016442","Var1: auditor_opinion_NA<br />Var2: auditor_opinion_NA<br />value:  1.000000000","Var1: parent_auditor_0<br />Var2: auditor_opinion_NA<br />value:  0.123109354","Var1: parent_auditor_1<br />Var2: auditor_opinion_NA<br />value: -0.123109354"],["Var1: code<br />Var2: parent_auditor_0<br />value:  0.054424698","Var1: year<br />Var2: parent_auditor_0<br />value: -0.027845666","Var1: common_stock<br />Var2: parent_auditor_0<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: parent_auditor_0<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: parent_auditor_0<br />value:           NA","Var1: common_equity<br />Var2: parent_auditor_0<br />value:           NA","Var1: total_liabilities<br />Var2: parent_auditor_0<br />value:           NA","Var1: long_term_debt<br />Var2: parent_auditor_0<br />value:           NA","Var1: total_assets<br />Var2: parent_auditor_0<br />value:           NA","Var1: preferred_stock<br />Var2: parent_auditor_0<br />value:           NA","Var1: market_cap<br />Var2: parent_auditor_0<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: parent_auditor_0<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: parent_auditor_0<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: parent_auditor_0<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: parent_auditor_0<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: parent_auditor_0<br />value:           NA","Var1: return_on_invested_capital<br />Var2: parent_auditor_0<br />value:           NA","Var1: net_margin<br />Var2: parent_auditor_0<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: parent_auditor_0<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: parent_auditor_0<br />value:           NA","Var1: cash_flow_sales<br />Var2: parent_auditor_0<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: parent_auditor_0<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: parent_auditor_0<br />value:           NA","Var1: AAER_0<br />Var2: parent_auditor_0<br />value:  0.019465221","Var1: AAER_1<br />Var2: parent_auditor_0<br />value: -0.019465221","Var1: auditor_opinion_1<br />Var2: parent_auditor_0<br />value: -0.012692612","Var1: auditor_opinion_5<br />Var2: parent_auditor_0<br />value: -0.046428555","Var1: auditor_opinion_6<br />Var2: parent_auditor_0<br />value: -0.107339072","Var1: auditor_opinion_7<br />Var2: parent_auditor_0<br />value: -0.026483078","Var1: auditor_opinion_NA<br />Var2: parent_auditor_0<br />value:  0.123109354","Var1: parent_auditor_0<br />Var2: parent_auditor_0<br />value:  1.000000000","Var1: parent_auditor_1<br />Var2: parent_auditor_0<br />value: -1.000000000"],["Var1: code<br />Var2: parent_auditor_1<br />value: -0.054424698","Var1: year<br />Var2: parent_auditor_1<br />value:  0.027845666","Var1: common_stock<br />Var2: parent_auditor_1<br />value:           NA","Var1: net_income_before_extraordinary_items<br />Var2: parent_auditor_1<br />value:           NA","Var1: net_sales_or_revenues<br />Var2: parent_auditor_1<br />value:           NA","Var1: common_equity<br />Var2: parent_auditor_1<br />value:           NA","Var1: total_liabilities<br />Var2: parent_auditor_1<br />value:           NA","Var1: long_term_debt<br />Var2: parent_auditor_1<br />value:           NA","Var1: total_assets<br />Var2: parent_auditor_1<br />value:           NA","Var1: preferred_stock<br />Var2: parent_auditor_1<br />value:           NA","Var1: market_cap<br />Var2: parent_auditor_1<br />value:           NA","Var1: equity_total_capital_ratio<br />Var2: parent_auditor_1<br />value:           NA","Var1: preferred_stock_total_capital_ratio<br />Var2: parent_auditor_1<br />value:           NA","Var1: long_term_debt_total_capital_ratio<br />Var2: parent_auditor_1<br />value:           NA","Var1: total_debt_total_capital_ratio<br />Var2: parent_auditor_1<br />value:           NA","Var1: total_percent_return_on_equity<br />Var2: parent_auditor_1<br />value:           NA","Var1: return_on_invested_capital<br />Var2: parent_auditor_1<br />value:           NA","Var1: net_margin<br />Var2: parent_auditor_1<br />value:           NA","Var1: fixed_charge_coverage_ratio<br />Var2: parent_auditor_1<br />value:           NA","Var1: divident_payout_percent_earnings_total_dollar<br />Var2: parent_auditor_1<br />value:           NA","Var1: cash_flow_sales<br />Var2: parent_auditor_1<br />value:           NA","Var1: total_reinvestment_rate<br />Var2: parent_auditor_1<br />value:           NA","Var1: net_sales_over_revenues_growth<br />Var2: parent_auditor_1<br />value:           NA","Var1: AAER_0<br />Var2: parent_auditor_1<br />value: -0.019465221","Var1: AAER_1<br />Var2: parent_auditor_1<br />value:  0.019465221","Var1: auditor_opinion_1<br />Var2: parent_auditor_1<br />value:  0.012692612","Var1: auditor_opinion_5<br />Var2: parent_auditor_1<br />value:  0.046428555","Var1: auditor_opinion_6<br />Var2: parent_auditor_1<br />value:  0.107339072","Var1: auditor_opinion_7<br />Var2: parent_auditor_1<br />value:  0.026483078","Var1: auditor_opinion_NA<br />Var2: parent_auditor_1<br />value: -0.123109354","Var1: parent_auditor_0<br />Var2: parent_auditor_1<br />value: -1.000000000","Var1: parent_auditor_1<br />Var2: parent_auditor_1<br />value:  1.000000000"]],"colorscale":[[0,"#0571B0"],[5.5511151231257827e-17,"#0571B0"],[0.015223188465709359,"#1E75B2"],[0.39741799940839356,"#D6E0EF"],[0.41292326916776612,"#DCE5F1"],[0.43844532287410587,"#E6ECF5"],[0.44633046399303278,"#E9EFF7"],[0.44789943054854392,"#EAEFF7"],[0.45719996301982757,"#EEF2F8"],[0.4631733529369842,"#F0F4F9"],[0.47278765124937894,"#F4F7FB"],[0.4767857224603218,"#F6F8FB"],[0.47784615600438196,"#F6F8FC"],[0.48488438650576687,"#F9FAFD"],[0.48607716686018593,"#F9FBFD"],[0.48675846085305563,"#FAFBFD"],[0.48815804476774149,"#FAFBFD"],[0.48914665964821608,"#FBFCFD"],[0.48956975900607391,"#FBFCFD"],[0.48979339767747077,"#FBFCFD"],[0.49026738946824566,"#FBFCFD"],[0.4929146098490077,"#FCFDFE"],[0.49365369418293226,"#FCFDFE"],[0.4949917790699489,"#FDFDFE"],[0.49516505900158958,"#FDFEFE"],[0.49645526112523625,"#FEFEFE"],[0.4985008526821823,"#FEFFFF"],[0.49872730585221964,"#FEFFFF"],[0.49910041178641734,"#FFFFFF"],[0.49946174991009051,"#FFFFFF"],[0.50149914731781775,"#FFFEFE"],[0.50354473887476381,"#FFFDFD"],[0.50483494099841042,"#FFFDFD"],[0.50541037828041924,"#FFFDFC"],[0.50634630581706774,"#FFFCFC"],[0.50901005440451652,"#FFFBFB"],[0.50947539988356405,"#FFFBFA"],[0.50973261053175434,"#FFFBFA"],[0.51020660232252923,"#FFFBFA"],[0.51043024099392609,"#FFFBFA"],[0.51044087846708031,"#FFFBFA"],[0.51085334035178387,"#FFFAFA"],[0.51324153914694437,"#FFF9F8"],[0.51392283313981413,"#FFF9F8"],[0.52169806198901258,"#FFF6F4"],[0.52215384399561804,"#FFF6F4"],[0.5232142775396782,"#FFF5F3"],[0.52721234875062106,"#FFF3F2"],[0.53979628046932016,"#FFEEEB"],[0.55366953600696722,"#FFE8E5"],[0.56155467712589413,"#FFE5E1"],[0.60389926331773447,"#FED3CC"],[0.617394990395147,"#FECDC6"],[1,"#CA0020"]],"type":"heatmap","showscale":false,"autocolorscale":false,"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1],"y":[1],"name":"99_3d92ccb38292baf0fa2d6ab6a8fa69b4","type":"scatter","mode":"markers","opacity":0,"hoverinfo":"skip","showlegend":false,"marker":{"color":[0,1],"colorscale":[[0,"#0571B0"],[0.0033444816053511683,"#0D72B1"],[0.0066889632107023367,"#1373B1"],[0.010033444816053505,"#1874B2"],[0.013377926421404673,"#1C74B2"],[0.016722408026755842,"#2075B3"],[0.02006688963210701,"#2376B3"],[0.023411371237458178,"#2677B4"],[0.026755852842809347,"#2978B4"],[0.030100334448160515,"#2C79B5"],[0.033444816053511683,"#2F7AB5"],[0.036789297658862852,"#317BB6"],[0.04013377926421402,"#347BB6"],[0.043478260869565188,"#367CB7"],[0.046822742474916357,"#397DB7"],[0.050167224080267581,"#3B7EB8"],[0.053511705685618749,"#3D7FB8"],[0.056856187290969917,"#3F80B9"],[0.060200668896321086,"#4181BA"],[0.063545150501672254,"#4382BA"],[0.066889632107023422,"#4583BB"],[0.070234113712374591,"#4783BB"],[0.073578595317725759,"#4984BC"],[0.076923076923076927,"#4B85BC"],[0.080267558528428096,"#4D86BD"],[0.083612040133779264,"#4E87BD"],[0.086956521739130432,"#5088BE"],[0.090301003344481601,"#5289BE"],[0.093645484949832769,"#548ABF"],[0.096989966555183937,"#558BBF"],[0.10033444816053511,"#578BC0"],[0.10367892976588627,"#598CC0"],[0.10702341137123744,"#5A8DC1"],[0.11036789297658861,"#5C8EC1"],[0.11371237458193978,"#5E8FC2"],[0.11705685618729095,"#5F90C3"],[0.12040133779264217,"#6191C3"],[0.12374581939799334,"#6392C4"],[0.12709030100334451,"#6493C4"],[0.13043478260869568,"#6694C5"],[0.13377926421404684,"#6795C5"],[0.13712374581939801,"#6995C6"],[0.14046822742474918,"#6A96C6"],[0.14381270903010035,"#6C97C7"],[0.14715719063545152,"#6E98C7"],[0.15050167224080269,"#6F99C8"],[0.15384615384615385,"#719AC8"],[0.15719063545150502,"#729BC9"],[0.16053511705685619,"#749CC9"],[0.16387959866220736,"#759DCA"],[0.16722408026755853,"#779ECA"],[0.1705685618729097,"#789FCB"],[0.17391304347826086,"#7AA0CC"],[0.17725752508361203,"#7BA1CC"],[0.1806020066889632,"#7DA1CD"],[0.18394648829431437,"#7EA2CD"],[0.18729096989966554,"#7FA3CE"],[0.19063545150501671,"#81A4CE"],[0.19397993311036787,"#82A5CF"],[0.19732441471571904,"#84A6CF"],[0.20066889632107021,"#85A7D0"],[0.20401337792642138,"#87A8D0"],[0.20735785953177255,"#88A9D1"],[0.21070234113712372,"#89AAD1"],[0.21404682274247488,"#8BABD2"],[0.21739130434782605,"#8CACD2"],[0.22073578595317722,"#8EADD3"],[0.22408026755852839,"#8FAED3"],[0.22742474916387956,"#91AFD4"],[0.23076923076923073,"#92B0D5"],[0.23411371237458189,"#93B1D5"],[0.23745819397993312,"#95B1D6"],[0.24080267558528429,"#96B2D6"],[0.24414715719063546,"#98B3D7"],[0.24749163879598662,"#99B4D7"],[0.25083612040133779,"#9AB5D8"],[0.25418060200668896,"#9CB6D8"],[0.25752508361204013,"#9DB7D9"],[0.2608695652173913,"#9EB8D9"],[0.26421404682274247,"#A0B9DA"],[0.26755852842809363,"#A1BADA"],[0.2709030100334448,"#A3BBDB"],[0.27424749163879597,"#A4BCDB"],[0.27759197324414714,"#A5BDDC"],[0.28093645484949831,"#A7BEDC"],[0.28428093645484948,"#A8BFDD"],[0.28762541806020064,"#A9C0DD"],[0.29096989966555181,"#ABC1DE"],[0.29431438127090298,"#ACC2DF"],[0.29765886287625415,"#AEC3DF"],[0.30100334448160537,"#AFC4E0"],[0.30434782608695654,"#B0C5E0"],[0.30769230769230771,"#B2C6E1"],[0.31103678929765888,"#B3C7E1"],[0.31438127090301005,"#B4C8E2"],[0.31772575250836121,"#B6C9E2"],[0.32107023411371238,"#B7CAE3"],[0.32441471571906355,"#B8CAE3"],[0.32775919732441472,"#BACBE4"],[0.33110367892976589,"#BBCCE4"],[0.33444816053511706,"#BDCDE5"],[0.33779264214046822,"#BECEE5"],[0.34113712374581939,"#BFCFE6"],[0.34448160535117056,"#C1D0E6"],[0.34782608695652173,"#C2D1E7"],[0.3511705685618729,"#C3D2E8"],[0.35451505016722407,"#C5D3E8"],[0.35785953177257523,"#C6D4E9"],[0.3612040133779264,"#C7D5E9"],[0.36454849498327757,"#C9D6EA"],[0.36789297658862874,"#CAD7EA"],[0.37123745819397991,"#CBD8EB"],[0.37458193979933108,"#CDD9EB"],[0.37792642140468224,"#CEDAEC"],[0.38127090301003341,"#CFDBEC"],[0.38461538461538458,"#D1DCED"],[0.38795986622073581,"#D2DDED"],[0.39130434782608697,"#D3DEEE"],[0.39464882943143814,"#D5DFEE"],[0.39799331103678931,"#D6E0EF"],[0.40133779264214048,"#D7E1EF"],[0.40468227424749165,"#D9E2F0"],[0.40802675585284282,"#DAE3F0"],[0.41137123745819398,"#DBE4F1"],[0.41471571906354515,"#DDE5F2"],[0.41806020066889632,"#DEE6F2"],[0.42140468227424749,"#DFE7F3"],[0.42474916387959866,"#E1E8F3"],[0.42809364548494983,"#E2E9F4"],[0.43143812709030099,"#E4EAF4"],[0.43478260869565216,"#E5EBF5"],[0.43812709030100333,"#E6ECF5"],[0.4414715719063545,"#E8EDF6"],[0.44481605351170567,"#E9EEF6"],[0.44816053511705684,"#EAEFF7"],[0.451505016722408,"#ECF0F7"],[0.45484949832775917,"#EDF1F8"],[0.45819397993311034,"#EEF2F8"],[0.46153846153846151,"#F0F3F9"],[0.46488294314381268,"#F1F4F9"],[0.46822742474916385,"#F2F5FA"],[0.47157190635451507,"#F4F6FB"],[0.47491638795986624,"#F5F7FB"],[0.47826086956521741,"#F6F8FC"],[0.48160535117056857,"#F8F9FC"],[0.48494983277591974,"#F9FAFD"],[0.48829431438127091,"#FAFBFD"],[0.49163879598662208,"#FCFCFE"],[0.49498327759197325,"#FDFDFE"],[0.49832775919732442,"#FEFEFF"],[0.50167224080267558,"#FFFEFE"],[0.50501672240802675,"#FFFDFD"],[0.50836120401337792,"#FFFBFB"],[0.51170568561872909,"#FFFAF9"],[0.51505016722408026,"#FFF9F8"],[0.51839464882943143,"#FFF7F6"],[0.52173913043478259,"#FFF6F4"],[0.52508361204013376,"#FFF4F3"],[0.52842809364548493,"#FFF3F1"],[0.5317725752508361,"#FFF2EF"],[0.53511705685618727,"#FFF0EE"],[0.53846153846153844,"#FFEFEC"],[0.5418060200668896,"#FFEDEA"],[0.54515050167224077,"#FFECE9"],[0.54849498327759194,"#FFEAE7"],[0.55183946488294311,"#FFE9E5"],[0.55518394648829428,"#FFE8E4"],[0.55852842809364545,"#FFE6E2"],[0.56187290969899661,"#FFE5E1"],[0.56521739130434778,"#FFE3DF"],[0.56856187290969895,"#FFE2DD"],[0.57190635451505012,"#FFE1DC"],[0.57525083612040129,"#FFDFDA"],[0.57859531772575246,"#FFDED8"],[0.58193979933110362,"#FFDCD7"],[0.58528428093645479,"#FFDBD5"],[0.58862876254180596,"#FFD9D4"],[0.59197324414715713,"#FFD8D2"],[0.5953177257525083,"#FED7D0"],[0.59866220735785947,"#FED5CF"],[0.60200668896321075,"#FED4CD"],[0.60535117056856191,"#FED2CC"],[0.60869565217391308,"#FED1CA"],[0.61204013377926425,"#FED0C8"],[0.61538461538461542,"#FECEC7"],[0.61872909698996659,"#FDCDC5"],[0.62207357859531776,"#FDCBC4"],[0.62541806020066892,"#FDCAC2"],[0.62876254180602009,"#FDC9C0"],[0.63210702341137126,"#FDC7BF"],[0.63545150501672243,"#FDC6BD"],[0.6387959866220736,"#FCC4BC"],[0.64214046822742477,"#FCC3BA"],[0.64548494983277593,"#FCC1B8"],[0.6488294314381271,"#FCC0B7"],[0.65217391304347827,"#FCBFB5"],[0.65551839464882944,"#FBBDB4"],[0.65886287625418061,"#FBBCB2"],[0.66220735785953178,"#FBBAB1"],[0.66555183946488294,"#FBB9AF"],[0.66889632107023411,"#FAB8AD"],[0.67224080267558528,"#FAB6AC"],[0.67558528428093645,"#FAB5AA"],[0.67892976588628762,"#FAB3A9"],[0.68227424749163879,"#F9B2A7"],[0.68561872909698995,"#F9B1A6"],[0.68896321070234112,"#F9AFA4"],[0.69230769230769229,"#F9AEA3"],[0.69565217391304346,"#F8ACA1"],[0.69899665551839463,"#F8ABA0"],[0.7023411371237458,"#F8A99E"],[0.70568561872909696,"#F7A89C"],[0.70903010033444813,"#F7A79B"],[0.7123745819397993,"#F7A599"],[0.71571906354515047,"#F6A498"],[0.71906354515050164,"#F6A296"],[0.72240802675585281,"#F6A195"],[0.72575250836120397,"#F5A093"],[0.72909698996655514,"#F59E92"],[0.73244147157190631,"#F59D90"],[0.73578595317725748,"#F49B8F"],[0.73913043478260865,"#F49A8D"],[0.74247491638795982,"#F4988C"],[0.74581939799331098,"#F3978A"],[0.74916387959866215,"#F39689"],[0.75250836120401332,"#F39487"],[0.75585284280936449,"#F29386"],[0.75919732441471566,"#F29184"],[0.76254180602006683,"#F19083"],[0.76588628762541799,"#F18E81"],[0.76923076923076916,"#F18D80"],[0.77257525083612044,"#F08B7E"],[0.77591973244147161,"#F08A7D"],[0.77926421404682278,"#EF897B"],[0.78260869565217395,"#EF877A"],[0.78595317725752512,"#EF8678"],[0.78929765886287628,"#EE8477"],[0.79264214046822745,"#EE8375"],[0.79598662207357862,"#ED8174"],[0.79933110367892979,"#ED8073"],[0.80267558528428096,"#EC7E71"],[0.80602006688963213,"#EC7D70"],[0.80936454849498329,"#EB7B6E"],[0.81270903010033446,"#EB7A6D"],[0.81605351170568563,"#EA786B"],[0.8193979933110368,"#EA776A"],[0.82274247491638797,"#EA7568"],[0.82608695652173914,"#E97467"],[0.8294314381270903,"#E97266"],[0.83277591973244147,"#E87164"],[0.83612040133779264,"#E86F63"],[0.83946488294314381,"#E76E61"],[0.84280936454849498,"#E76C60"],[0.84615384615384615,"#E66B5E"],[0.84949832775919731,"#E6695D"],[0.85284280936454848,"#E5685C"],[0.85618729096989965,"#E4665A"],[0.85953177257525082,"#E46559"],[0.86287625418060199,"#E36357"],[0.86622073578595316,"#E36256"],[0.86956521739130432,"#E26055"],[0.87290969899665549,"#E25E53"],[0.87625418060200666,"#E15D52"],[0.87959866220735783,"#E15B50"],[0.882943143812709,"#E05A4F"],[0.88628762541806017,"#E0584E"],[0.88963210702341133,"#DF564C"],[0.8929765886287625,"#DE554B"],[0.89632107023411367,"#DE5349"],[0.89966555183946484,"#DD5148"],[0.90301003344481601,"#DD5047"],[0.90635451505016718,"#DC4E45"],[0.90969899665551834,"#DC4C44"],[0.91304347826086951,"#DB4A43"],[0.91638795986622068,"#DA4941"],[0.91973244147157185,"#DA4740"],[0.92307692307692302,"#D9453E"],[0.92642140468227419,"#D8433D"],[0.92976588628762535,"#D8413C"],[0.93311036789297652,"#D73F3A"],[0.93645484949832769,"#D73D39"],[0.93979933110367886,"#D63B38"],[0.94314381270903014,"#D53936"],[0.94648829431438131,"#D53735"],[0.94983277591973247,"#D43534"],[0.95317725752508364,"#D33332"],[0.95652173913043481,"#D33131"],[0.95986622073578598,"#D22F30"],[0.96321070234113715,"#D12C2E"],[0.96655518394648832,"#D12A2D"],[0.96989966555183948,"#D0272C"],[0.97324414715719065,"#CF242A"],[0.97658862876254182,"#CF2129"],[0.97993311036789299,"#CE1E28"],[0.98327759197324416,"#CD1B27"],[0.98662207357859533,"#CD1725"],[0.98996655518394649,"#CC1324"],[0.99331103678929766,"#CB0D23"],[0.99665551839464883,"#CB0721"],[1,"#CA0020"]],"colorbar":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"thickness":23.039999999999996,"title":"Correlation Meter","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"tickmode":"array","ticktext":["-1.0","-0.5","0.0","0.5","1.0"],"tickvals":[0,0.25,0.5,0.75,1],"tickfont":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"ticklen":2,"len":0.5}},"xaxis":"x","yaxis":"y","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":291.50684931506862,"l":288.58447488584483},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,32.600000000000001],"tickmode":"array","ticktext":["code","year","common_stock","net_income_before_extraordinary_items","net_sales_or_revenues","common_equity","total_liabilities","long_term_debt","total_assets","preferred_stock","market_cap","equity_total_capital_ratio","preferred_stock_total_capital_ratio","long_term_debt_total_capital_ratio","total_debt_total_capital_ratio","total_percent_return_on_equity","return_on_invested_capital","net_margin","fixed_charge_coverage_ratio","divident_payout_percent_earnings_total_dollar","cash_flow_sales","total_reinvestment_rate","net_sales_over_revenues_growth","AAER_0","AAER_1","auditor_opinion_1","auditor_opinion_5","auditor_opinion_6","auditor_opinion_7","auditor_opinion_NA","parent_auditor_0","parent_auditor_1"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],"categoryorder":"array","categoryarray":["code","year","common_stock","net_income_before_extraordinary_items","net_sales_or_revenues","common_equity","total_liabilities","long_term_debt","total_assets","preferred_stock","market_cap","equity_total_capital_ratio","preferred_stock_total_capital_ratio","long_term_debt_total_capital_ratio","total_debt_total_capital_ratio","total_percent_return_on_equity","return_on_invested_capital","net_margin","fixed_charge_coverage_ratio","divident_payout_percent_earnings_total_dollar","cash_flow_sales","total_reinvestment_rate","net_sales_over_revenues_growth","AAER_0","AAER_1","auditor_opinion_1","auditor_opinion_5","auditor_opinion_6","auditor_opinion_7","auditor_opinion_NA","parent_auditor_0","parent_auditor_1"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-90,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Features","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,32.600000000000001],"tickmode":"array","ticktext":["code","year","common_stock","net_income_before_extraordinary_items","net_sales_or_revenues","common_equity","total_liabilities","long_term_debt","total_assets","preferred_stock","market_cap","equity_total_capital_ratio","preferred_stock_total_capital_ratio","long_term_debt_total_capital_ratio","total_debt_total_capital_ratio","total_percent_return_on_equity","return_on_invested_capital","net_margin","fixed_charge_coverage_ratio","divident_payout_percent_earnings_total_dollar","cash_flow_sales","total_reinvestment_rate","net_sales_over_revenues_growth","AAER_0","AAER_1","auditor_opinion_1","auditor_opinion_5","auditor_opinion_6","auditor_opinion_7","auditor_opinion_NA","parent_auditor_0","parent_auditor_1"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],"categoryorder":"array","categoryarray":["code","year","common_stock","net_income_before_extraordinary_items","net_sales_or_revenues","common_equity","total_liabilities","long_term_debt","total_assets","preferred_stock","market_cap","equity_total_capital_ratio","preferred_stock_total_capital_ratio","long_term_debt_total_capital_ratio","total_debt_total_capital_ratio","total_percent_return_on_equity","return_on_invested_capital","net_margin","fixed_charge_coverage_ratio","divident_payout_percent_earnings_total_dollar","cash_flow_sales","total_reinvestment_rate","net_sales_over_revenues_growth","AAER_0","AAER_1","auditor_opinion_1","auditor_opinion_5","auditor_opinion_6","auditor_opinion_7","auditor_opinion_NA","parent_auditor_0","parent_auditor_1"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Features","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"5f0c3fdd6041":{"x":{},"y":{},"fill":{},"type":"heatmap"}},"cur_data":"5f0c3fdd6041","visdat":{"5f0c3fdd6041":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The red correlation shows the variable correlated to itself (which is obviously 1), the blue correlation are the same factor variable’s factor levels (eg. AAER=0 and AAER=1) being correlated by -1, which is expected. There is no significant correlation between 2 different variables. As such, we conclude that all X variables are not correlated to one another and can be used in the logistic modelling process.</p>
<p>Since we have decided not to drop any variables, we now have to deal with all the NA values. Firstly, we group by company code and backfill the values based on the last recorded value in a company. This is better than merely imputing the mean of company code, as this is able to capture trends over time while a mean is unable to do so.</p>
<p>Function to backfill missing values within each group</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>backfill_group <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(x))) {</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If there are non-NA values, fill missing values with last non-NA value</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.locf</span>(x, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If all values are NA, return as is</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I decided to define this object as df_aaer2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df_aaer2 <span class="ot">&lt;-</span> df_aaer1<span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(code,year)<span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code)<span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(year, auditor_opinion, parent_auditor), backfill_group))<span class="sc">|&gt;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we re-look at our NA after this first step of imputation, it looks way better. It is worth noting at this point that parent_auditor has no NA values because when I factorised it to “Big 4” and “Other” (non-big 4), the small amount of NA values (6%) were characterised as the level of “Other”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_missing</span>(df_aaer2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For the variables there were not able to be filled by backfilling, this suggests that these are companies with NA data in every record. In this case, it is unwise to fill it by imputing the mean of the entire column as one would usually do, and I decided to group by market cap then take the mean.</p>
<p>This means that if the company is large, then it will be imputed by a large cap mean values, and small companies will be imputed by small cap mean values. Hence, this allows us to impute data as accurately as possible by assigning small companies and large companies different means in accordance to their market cap.</p>
<p>Firstly, we have to convert market cap to factor, and levels are sorted ordinally.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df_aaer2 <span class="ot">=</span> df_aaer2 <span class="sc">%&gt;%</span>   <span class="fu">mutate</span>(<span class="at">market_cap =</span> <span class="fu">case_when</span>(     market_cap <span class="sc">&gt;</span> <span class="dv">200000000000</span> <span class="sc">~</span> <span class="st">"Mega-cap"</span>,     market_cap <span class="sc">&gt;</span> <span class="dv">10000000000</span> <span class="sc">&amp;</span> market_cap <span class="sc">&lt;=</span> <span class="dv">200000000000</span> <span class="sc">~</span> <span class="st">"Large-cap"</span>,     market_cap <span class="sc">&gt;</span> <span class="dv">2000000000</span> <span class="sc">&amp;</span> market_cap <span class="sc">&lt;=</span> <span class="dv">10000000000</span> <span class="sc">~</span> <span class="st">"Mid-cap"</span>,     market_cap <span class="sc">&gt;</span> <span class="dv">250000000</span> <span class="sc">&amp;</span> market_cap <span class="sc">&lt;=</span> <span class="dv">2000000000</span> <span class="sc">~</span> <span class="st">"Small-cap"</span>,     market_cap <span class="sc">&lt;=</span> <span class="dv">250000000</span> <span class="sc">~</span> <span class="st">"Micro-cap"</span>   ))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>mktcap_order <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Unknown"</span>, <span class="st">"Micro-cap"</span>, <span class="st">"Small-cap"</span>,                   <span class="st">"Mid-cap"</span>,<span class="st">"Large-cap"</span>, <span class="st">"Mega-cap"</span>)  </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>df_aaer2<span class="sc">$</span>market_cap <span class="ot">=</span> <span class="fu">na.fill</span>(df_aaer2<span class="sc">$</span>market_cap, <span class="at">fill =</span> <span class="st">"Unknown"</span>) </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>df_aaer2<span class="sc">$</span>market_cap <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_aaer2<span class="sc">$</span>market_cap,<span class="at">levels =</span> mktcap_order,                                   <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>df_aaer2 <span class="ot">&lt;-</span> df_aaer2<span class="sc">|&gt;</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(market_cap)<span class="sc">|&gt;</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For all variables except AAER (y variable), if na, take mean, else take value in the record</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(AAER,auditor_opinion, parent_auditor), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">mean</span>(., <span class="at">na.rm=</span><span class="cn">TRUE</span>), .)))<span class="sc">|&gt;</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_missing</span>(df_aaer2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now all that’s left is to fill auditor_opinion NA values. This is tricky as auditor_opinion is not numeric, but categorical, so we cannot impute based on mean or backfilling, etc. And each level means a different thing. Therefore, we have to use accountancy logic to impute NA values. Ultimately, we decided to take a conservative approach to impute NA with 1, “not audited”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_aaer2 <span class="ot">&lt;-</span> df_aaer2 <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">auditor_opinion =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(auditor_opinion),<span class="fu">as.factor</span>(<span class="dv">1</span>),auditor_opinion))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>df_aaer2 <span class="sc">|&gt;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_missing</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Lastly, we have to look at how skewed the data is. For skewed X variables, it is imperative that we perform log transformation such that data is normalized. For this, I tried to use a histogram to check skewness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_aaer2<span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Imo, it is hard to visually evaluate which variables are skewed based on the histogram. Hence, we can use a fxn.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>log_and_drop_skewed_numeric_columns <span class="ot">&lt;-</span> <span class="cf">function</span>(df, threshold, small_number) {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">names</span>(df)) {</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.numeric</span>(df[[col]])) {</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>            skew <span class="ot">&lt;-</span> <span class="fu">skewness</span>(df[[col]])</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="fu">abs</span>(skew) <span class="sc">&gt;</span> threshold) {</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>                log_col_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"log_"</span>, col)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Log-transform positive values with the addition of a small number</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>                df[[log_col_name]] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df[[col]] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="fu">log</span>(df[[col]] <span class="sc">+</span> small_number), df[[col]])</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>                df[[col]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the skewness threshold (absolute value)</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>skewness_threshold <span class="ot">=</span> <span class="dv">10</span> </span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>small_number <span class="ot">=</span> <span class="fl">0.01</span>  </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function and get the list of skewed columns </span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>df_aaer3 <span class="ot">=</span> <span class="fu">log_and_drop_skewed_numeric_columns</span>(df_aaer2, skewness_threshold, small_number)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced</code></pre>
</div>
</div>
<p>df_aaer3 is log transformed. df_aaer2 is the non log-transformed data.</p>
<p>Running both the df_aaer2 and df_aaer3 models in a seperate test script produced good results in terms of AUC. However, we could explore more…</p>
<p>We also saw that the raw accounting line items are inaccurate because of currency inconsistencies. Some records are in USD, while other records from other countries are in other currencies (eg. Argentina uses peso, Singapore uses SGD…).</p>
<p>This is captured in ITEM6099, “Currency Of Document”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df_aaer <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ITEM6099)<span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 1
   ITEM6099
   &lt;chr&gt;   
 1 USD     
 2 EUR     
 3 &lt;NA&gt;    
 4 MXN     
 5 ESP     
 6 CLP     
 7 ARS     
 8 COP     
 9 VES     
10 HKD     
# ℹ 23 more rows</code></pre>
</div>
</div>
<p>To mitigate this problem, we came up with 2 more models:</p>
<ol type="1">
<li>A percent change model, where each record is a percent change relative to the previous year.</li>
</ol>
<ul>
<li>Potential flaw: Percent change model would not be able to differentiate between large companies and small companies, as the absolute values/magnitude of values are not captured. Instead, percent change values are captured.</li>
</ul>
<ol start="2" type="1">
<li>A currency adjusted model, where each record has been transformed from its respective foreign currency into the USD.</li>
</ol>
</section>
<section id="eda-on-percent-change-model" class="level2">
<h2 class="anchored" data-anchor-id="eda-on-percent-change-model">2.3 EDA on percent change model</h2>
<p>One issue of taking percent change is that some variables (log preferred stock, long term debt) contain “0” in some of their records. In this case, the percent change will be infinity as even an increase of +1 to 0 is infinite. Hence, I will add an arbitrary small number to very small lagged values, to ensure there are no infinite percent change values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df_aaer4 <span class="ot">&lt;-</span> df_aaer3 <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(code, year) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>),    <span class="co"># Select the 8 raw accounting line items</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> {</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                  denominator <span class="ot">&lt;-</span> <span class="fu">lag</span>(.)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                  denominator[<span class="fu">abs</span>(denominator) <span class="sc">&lt;</span> <span class="fl">0.01</span>] <span class="ot">&lt;-</span> <span class="fl">0.01</span>  <span class="co"># Replace very small values with 0.01</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                  ((. <span class="sc">-</span> <span class="fu">lag</span>(.)) <span class="sc">/</span> denominator) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">'change_in_{col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># de-selecting the variables which we applied the percent change to</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(log_common_equity, log_net_income_before_extraordinary_items, log_net_sales_or_revenues, total_assets, total_liabilities, log_common_stock, long_term_debt, log_preferred_stock)) <span class="sc">%&gt;%</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_missing</span>(df_aaer4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>NA values occur from records where there are no previous record from a year before. (eg. if 2000 is the first year of incidence, it is NA as there is no 1999 data to calculate the percent change).</p>
<p>For these NA values, I decided to just filter out the first record rows which contain these NA values. This is akin to simply dropping NA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_aaer4 <span class="ot">&lt;-</span> df_aaer4<span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="eda-on-currency-adjusted-model" class="level2">
<h2 class="anchored" data-anchor-id="eda-on-currency-adjusted-model">2.4 EDA on currency adjusted model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df_aaer5 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/rayne/Documents/y4s2/ACCT420_forensic_forecasting/currency_adj/banks_final_aaer.csv"</span>)<span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITEM6010 <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="dv">2023</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 37662 Columns: 547
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (40): freq, ITEM5601, ITEM6006, isin.x, ITEM6035, ITEM6038, ITEM6099, ...
dbl  (463): code, year, ITEM1001, ITEM1051, ITEM1084, ITEM1100, ITEM1101, IT...
lgl   (41): ITEM3257, ITEM6004, ITEM11557, ITEM11558, ITEM11559, ITEM18063, ...
date   (3): ITEM5350, ITEM7015, ITEM11516

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df_aaer5 <span class="ot">&lt;-</span> df_aaer5 <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AAER, code, year, CurrAdj_ITEM3480, CurrAdj_ITEM1551, CurrAdj_ITEM3501, CurrAdj_ITEM3351, CurrAdj_ITEM3251, CurrAdj_ITEM2999, CurrAdj_ITEM3451, CurrAdj_ITEM7240,ITEM7210, ITEM8201, ITEM8206, ITEM8216, ITEM8221, ITEM8301, ITEM8376, ITEM8366, ITEM8251, ITEM8256, ITEM8311, ITEM8656, ITEM8631, ITEM7546, ITEM7800) <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">adj_common_stock=</span>CurrAdj_ITEM3480, <span class="at">adj_net_income_before_extraordinary_items=</span>CurrAdj_ITEM1551, <span class="at">adj_net_sales_or_revenues=</span>CurrAdj_ITEM7240, <span class="at">adj_common_equity=</span>CurrAdj_ITEM3501, <span class="at">adj_total_liabilities=</span>CurrAdj_ITEM3351, <span class="at">adj_long_term_debt=</span>CurrAdj_ITEM3251, <span class="at">adj_total_assets=</span>CurrAdj_ITEM2999, <span class="at">adj_preferred_stock=</span>CurrAdj_ITEM3451,<span class="at">market_cap=</span>ITEM7210, <span class="at">equity_total_capital_ratio=</span>ITEM8201, <span class="at">preferred_stock_total_capital_ratio=</span>ITEM8206, <span class="at">long_term_debt_total_capital_ratio=</span>ITEM8216, <span class="at">total_debt_total_capital_ratio=</span>ITEM8221, <span class="at">total_percent_return_on_equity=</span>ITEM8301, <span class="at">return_on_invested_capital=</span>ITEM8376, <span class="at">net_margin=</span>ITEM8366, <span class="at">fixed_charge_coverage_ratio=</span>ITEM8251, <span class="at">divident_payout_percent_earnings_total_dollar=</span>ITEM8256, <span class="at">cash_flow_sales=</span>ITEM8311, <span class="at">total_reinvestment_rate=</span>ITEM8656, <span class="at">net_sales_over_revenues_growth=</span>ITEM8631, <span class="at">auditor_opinion=</span>ITEM7546, <span class="at">parent_auditor=</span>ITEM7800)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we simply repeat the data pre-processing steps (nth new, please skip this part and go to 2.5).</p>
<p>Backfill by company last value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># backfill by company</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>df_aaer5 <span class="ot">&lt;-</span> df_aaer5<span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(code,year)<span class="sc">|&gt;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code)<span class="sc">|&gt;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(year, auditor_opinion, parent_auditor), backfill_group))<span class="sc">|&gt;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NA imputation based on mean market cap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df_aaer5 <span class="ot">=</span> df_aaer5 <span class="sc">%&gt;%</span>   <span class="fu">mutate</span>(<span class="at">market_cap =</span> <span class="fu">case_when</span>(     market_cap <span class="sc">&gt;</span> <span class="dv">200000000000</span> <span class="sc">~</span> <span class="st">"Mega-cap"</span>,     market_cap <span class="sc">&gt;</span> <span class="dv">10000000000</span> <span class="sc">&amp;</span> market_cap <span class="sc">&lt;=</span> <span class="dv">200000000000</span> <span class="sc">~</span> <span class="st">"Large-cap"</span>,     market_cap <span class="sc">&gt;</span> <span class="dv">2000000000</span> <span class="sc">&amp;</span> market_cap <span class="sc">&lt;=</span> <span class="dv">10000000000</span> <span class="sc">~</span> <span class="st">"Mid-cap"</span>,     market_cap <span class="sc">&gt;</span> <span class="dv">250000000</span> <span class="sc">&amp;</span> market_cap <span class="sc">&lt;=</span> <span class="dv">2000000000</span> <span class="sc">~</span> <span class="st">"Small-cap"</span>,     market_cap <span class="sc">&lt;=</span> <span class="dv">250000000</span> <span class="sc">~</span> <span class="st">"Micro-cap"</span>   ))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>mktcap_order <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Unknown"</span>, <span class="st">"Micro-cap"</span>, <span class="st">"Small-cap"</span>,                   <span class="st">"Mid-cap"</span>,<span class="st">"Large-cap"</span>, <span class="st">"Mega-cap"</span>)  </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>df_aaer5<span class="sc">$</span>market_cap <span class="ot">=</span> <span class="fu">na.fill</span>(df_aaer5<span class="sc">$</span>market_cap, <span class="at">fill =</span> <span class="st">"Unknown"</span>) </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>df_aaer5<span class="sc">$</span>market_cap <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_aaer5<span class="sc">$</span>market_cap,<span class="at">levels =</span> mktcap_order,                                   <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>df_aaer5 <span class="ot">&lt;-</span> df_aaer5<span class="sc">|&gt;</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(market_cap)<span class="sc">|&gt;</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For all variables except AAER (y variable), if na, take mean, else take value in the record</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(AAER,auditor_opinion, parent_auditor), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">mean</span>(., <span class="at">na.rm=</span><span class="cn">TRUE</span>), .)))<span class="sc">|&gt;</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Converting to factor and filling auditor_opinion NAs to factor level of 1, “not audited”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df_aaer5 <span class="ot">&lt;-</span> df_aaer5<span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parent_auditor =</span> <span class="fu">case_when</span>(</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"KPMG|Deloitte|PricewaterhouseCoopers|Ernst &amp; Young"</span>, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>          parent_auditor, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Big 4"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  ))<span class="sc">|&gt;</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert Big 4 into factor, 1 if "Big 4", 0 if "Other"</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parent_auditor=</span><span class="fu">factor</span>(parent_auditor,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"Big 4"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))<span class="sc">|&gt;</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">auditor_opinion=</span><span class="fu">as.factor</span>(auditor_opinion))</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>df_aaer5 <span class="ot">&lt;-</span> df_aaer5 <span class="sc">|&gt;</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">auditor_opinion =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(auditor_opinion),<span class="fu">as.factor</span>(<span class="dv">1</span>),auditor_opinion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Apply log to skewed variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df_aaer5 <span class="ot">&lt;-</span> <span class="fu">log_and_drop_skewed_numeric_columns</span>(df_aaer5, skewness_threshold, small_number)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced

Warning in log(df[[col]] + small_number): NaNs produced</code></pre>
</div>
</div>
</section>
<section id="conclusion-of-feature-engineeringeda" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-of-feature-engineeringeda">2.5 Conclusion of feature engineering/EDA</h2>
<p>In conclusion, we have build and tested 4 different model loadouts:</p>
<ol type="1">
<li>raw model (df_aaer2)</li>
<li>log-transformed model (df_aaer3)</li>
<li>log-transformed percent change model (df_aaer4)</li>
<li>log-transformed currency adjusted model (df_aaer5)</li>
</ol>
<p>Upon running my model test script, I found that model 2 had the best AUC results (alogorithm: Xgboost), while model 4 was a very close second (also Xgboost). Therefore, for the Model building section, I will focus on model 2.</p>
</section>
</section>
<section id="model-building" class="level1">
<h1>3. Model building</h1>
<p>For model 2: log-transformed model</p>
<section id="splitting-train-test-set" class="level2">
<h2 class="anchored" data-anchor-id="splitting-train-test-set">3.1 Splitting train test set</h2>
<p>Creating a custom function that will perform stratified sampling in 80-20 train test ratio. We use stratified sampling as AAER occurrences are very small, and stratified sampling is able to deal with class imbalances.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>split_df <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(df, <span class="at">prop =</span> <span class="fl">0.8</span>, <span class="at">strata =</span> AAER)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract training and testing data</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add indicator column for test data (1 for test, 0 for train)</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Test =</span> <span class="dv">1</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add indicator column for train data (1 for test, 0 for train)</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Test =</span> <span class="dv">0</span>)</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine train and test data</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(train_data, test_data)</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create train test split and remove columns not in the model building process</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df_aaer3 <span class="ot">&lt;-</span> <span class="fu">split_df</span>(df_aaer3)<span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>market_cap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">3.2 Logistic regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>logm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(AAER <span class="sc">~</span>. <span class="sc">-</span>code<span class="sc">-</span>year<span class="sc">-</span>Test, <span class="at">data=</span>df_aaer3[df_aaer3<span class="sc">$</span>Test<span class="sc">==</span><span class="dv">0</span>,], <span class="at">family=</span>binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = AAER ~ . - code - year - Test, family = binomial, 
    data = df_aaer3[df_aaer3$Test == 0, ])

Coefficients:
                                                Estimate Std. Error z value
(Intercept)                                   -3.386e+00  5.038e-01  -6.720
total_liabilities                             -1.342e-11  3.041e-12  -4.412
long_term_debt                                 3.419e-11  3.960e-12   8.634
total_assets                                   6.281e-12  2.625e-12   2.393
long_term_debt_total_capital_ratio             2.475e-02  5.420e-03   4.566
divident_payout_percent_earnings_total_dollar -9.678e-03  3.743e-03  -2.585
auditor_opinion5                              -1.253e+01  3.476e+02  -0.036
auditor_opinion6                               3.800e-02  2.259e-01   0.168
auditor_opinion7                              -1.876e+01  3.356e+04  -0.001
parent_auditor1                               -1.602e-01  2.283e-01  -0.702
log_common_stock                              -2.186e-02  2.164e-02  -1.010
log_net_income_before_extraordinary_items      3.870e-10  2.469e-10   1.568
log_net_sales_or_revenues                      8.599e-07  2.837e-05   0.030
log_common_equity                              1.498e-06  1.073e-06   1.395
log_preferred_stock                            4.899e-02  1.162e-02   4.216
log_equity_total_capital_ratio                -1.845e-02  6.900e-02  -0.267
log_preferred_stock_total_capital_ratio       -2.535e-01  6.976e-02  -3.633
log_total_debt_total_capital_ratio            -4.829e-01  8.378e-02  -5.765
log_total_percent_return_on_equity            -4.307e-03  4.933e-03  -0.873
log_return_on_invested_capital                -1.779e-02  1.364e-02  -1.305
log_net_margin                                 4.303e-03  5.707e-03   0.754
log_fixed_charge_coverage_ratio                5.410e-06  2.574e-05   0.210
log_cash_flow_sales                            4.841e-03  5.196e-03   0.932
log_total_reinvestment_rate                   -3.826e-03  4.458e-03  -0.858
log_net_sales_over_revenues_growth            -2.339e-02  7.578e-03  -3.086
                                              Pr(&gt;|z|)    
(Intercept)                                   1.81e-11 ***
total_liabilities                             1.03e-05 ***
long_term_debt                                 &lt; 2e-16 ***
total_assets                                   0.01672 *  
long_term_debt_total_capital_ratio            4.98e-06 ***
divident_payout_percent_earnings_total_dollar  0.00973 ** 
auditor_opinion5                               0.97125    
auditor_opinion6                               0.86642    
auditor_opinion7                               0.99955    
parent_auditor1                                0.48283    
log_common_stock                               0.31246    
log_net_income_before_extraordinary_items      0.11699    
log_net_sales_or_revenues                      0.97582    
log_common_equity                              0.16289    
log_preferred_stock                           2.49e-05 ***
log_equity_total_capital_ratio                 0.78919    
log_preferred_stock_total_capital_ratio        0.00028 ***
log_total_debt_total_capital_ratio            8.19e-09 ***
log_total_percent_return_on_equity             0.38263    
log_return_on_invested_capital                 0.19203    
log_net_margin                                 0.45082    
log_fixed_charge_coverage_ratio                0.83356    
log_cash_flow_sales                            0.35144    
log_total_reinvestment_rate                    0.39069    
log_net_sales_over_revenues_growth             0.00203 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1855.1  on 14729  degrees of freedom
Residual deviance: 1570.9  on 14705  degrees of freedom
AIC: 1620.9

Number of Fisher Scoring iterations: 23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df_aaer3<span class="sc">$</span>pred_AAER <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm1, df_aaer3, <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Analysis:</p>
<p>From the logistic regression, the significant variables in predicting AAER are total liabilities, long-term debt, total assets, long term debt to total capital ratio, total dollar percent earnings dividend payout, log preferred stock, log preferred stock to total capital ratio, log total debt to total capital ratio, and log total reinvestment rate.</p>
<p>The coefficient on these variables are how much these variables affect our prediction. For example, a 1 unit increase in total liabilities leads to a -1.438e-11 probability of AAER (total liabilities reduces the probability of AAER), while a 1 unit increase in long term debt leads to a 3.821e-11 probability of AAER (long-term debt increases the probability of AAER), and so on…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in-sample confusion matrix</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>confmat.train <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(<span class="fu">ifelse</span>(logm1<span class="sc">$</span>fitted.values <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">as.factor</span>(df_aaer3[df_aaer3<span class="sc">$</span>Test<span class="sc">==</span><span class="dv">0</span>,]<span class="sc">$</span>AAER),</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>confmat.train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0 14552   157
         1     8    13
                                         
               Accuracy : 0.9888         
                 95% CI : (0.987, 0.9904)
    No Information Rate : 0.9885         
    P-Value [Acc &gt; NIR] : 0.3684         
                                         
                  Kappa : 0.1339         
                                         
 Mcnemar's Test P-Value : &lt;2e-16         
                                         
            Sensitivity : 0.0764706      
            Specificity : 0.9994505      
         Pos Pred Value : 0.6190476      
         Neg Pred Value : 0.9893263      
             Prevalence : 0.0115411      
         Detection Rate : 0.0008826      
   Detection Prevalence : 0.0014257      
      Balanced Accuracy : 0.5379606      
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># out-of-sample confusion matrix</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>confmat.test <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(df_aaer3[df_aaer3<span class="sc">$</span>Test <span class="sc">==</span> <span class="dv">1</span>,]<span class="sc">$</span>pred_AAER <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>(df_aaer3[df_aaer3<span class="sc">$</span>Test <span class="sc">==</span> <span class="dv">1</span>,]<span class="sc">$</span>AAER), </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive =</span> <span class="st">"1"</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>confmat.test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 3633   39
         1    5    6
                                         
               Accuracy : 0.9881         
                 95% CI : (0.984, 0.9913)
    No Information Rate : 0.9878         
    P-Value [Acc &gt; NIR] : 0.4798         
                                         
                  Kappa : 0.2105         
                                         
 Mcnemar's Test P-Value : 6.527e-07      
                                         
            Sensitivity : 0.133333       
            Specificity : 0.998626       
         Pos Pred Value : 0.545455       
         Neg Pred Value : 0.989379       
             Prevalence : 0.012218       
         Detection Rate : 0.001629       
   Detection Prevalence : 0.002987       
      Balanced Accuracy : 0.565979       
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<p>Analysis: Classification matrix with a 0.5 cut-off demonstrates…</p>
<ul>
<li><p>High Accuracy of 98.81%.</p></li>
<li><p>Low Sensitivity of 13.33%, due to the class imbalances even despite stratified sampling.</p></li>
<li><p>High Specitivity of 99.9%.</p></li>
</ul>
<p>This could be due to the class imbalances where there are too many instances of the majority class in the data. For example,</p>
<p>No Information Rate (NIR) is the accuracy that could be achieved by always predicting the majority class. In this case, the NIR is 0.9878, which suggests that the majority class constitutes 98.78% of the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>auc_in <span class="ot">&lt;-</span> df_aaer3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, pred_AAER, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>auc_out <span class="ot">&lt;-</span> df_aaer3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, pred_AAER, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>curve_in <span class="ot">&lt;-</span> df_aaer3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, pred_AAER, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>curve_out <span class="ot">&lt;-</span> df_aaer3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, pred_AAER, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_in, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"AAER, In Sample"</span>)) <span class="sc">+</span> </span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_out, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"AAER, Out of Sample"</span>)) <span class="sc">+</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>aucs <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in<span class="sc">$</span>.estimate, auc_out<span class="sc">$</span>.estimate)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample AUC"</span>, <span class="st">"Out of sample AUC"</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>aucs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample AUC Out of sample AUC 
        0.7475618         0.7451041 </code></pre>
</div>
</div>
<p>Analysis: The logistic regression performs well with AUC of around 0.75 for both in-sample and out-sample.</p>
</section>
<section id="lasso" class="level2">
<h2 class="anchored" data-anchor-id="lasso">3.3 Lasso</h2>
<p>Using tidymodels</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>aaer_eq <span class="ot">&lt;-</span><span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"AAER ~ long_term_debt+long_term_debt_total_capital_ratio+auditor_opinion+log_common_stock+log_net_sales_or_revenues+log_preferred_stock+log_preferred_stock_total_capital_ratio+log_total_percent_return_on_equity+log_net_margin+log_cash_flow_sales+log_net_sales_over_revenues_growth+total_liabilities+total_assets+divident_payout_percent_earnings_total_dollar+parent_auditor+log_net_income_before_extraordinary_items+log_common_equity+log_equity_total_capital_ratio+log_return_on_invested_capital+log_fixed_charge_coverage_ratio+log_total_reinvestment_rate"</span>))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>aaer_formula <span class="ot">&lt;-</span> aaer_eq</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># need to convert AAER, auditor_opinion, parent_auditor from factor to numeric for prep() fxn to work</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>df_aaer3 <span class="ot">&lt;-</span> df_aaer3 <span class="sc">|&gt;</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AAER =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(AAER)), </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">auditor_opinion =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(auditor_opinion)))<span class="sc">|&gt;</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">parent_auditor =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(parent_auditor)))</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> df_aaer3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> df_aaer3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(aaer_formula, <span class="at">data =</span> train) <span class="sc">%&gt;%</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Drop any variables with zero variance</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Center all prediction variables (i.e. avg value = 0)</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Scale all prediction variables (scaled to Z-score)</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_intercept</span>() <span class="sc">%&gt;%</span>  <span class="co"># Add an intercept to the model</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_num2factor</span>(<span class="fu">all_outcomes</span>(), <span class="at">ordered =</span> T, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"1"</span>),</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">transform =</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span>)  <span class="co"># Convert DV to factor for parsnip later</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>prepped <span class="ot">&lt;-</span> rec <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training=</span>train) <span class="co"># an intermediate step</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a><span class="co"># "bake" your recipe to get data ready</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>train_baked  <span class="ot">&lt;-</span> <span class="fu">bake</span>(prepped, <span class="at">new_data =</span> train)</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>test_baked  <span class="ot">&lt;-</span> <span class="fu">bake</span>(prepped, <span class="at">new_data =</span> test)</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>train_model <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">mixture=</span><span class="dv">1</span>, <span class="at">penalty=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># mixture = 1 sets LASSO</span></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'glmnet'</span>) <span class="sc">%&gt;%</span> <span class="co"># use the glmnet package to compute this</span></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(aaer_formula, <span class="at">data =</span> train_baked)</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a><span class="fu">coefplot</span>(train_model<span class="sc">$</span>fit, <span class="at">sort=</span><span class="st">'magnitude'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>cross validation to help us decide which model to pick</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>rec2 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(aaer_formula, <span class="at">data =</span> train) <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Drop any variables with zero variance</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Center all prediction variables (i.e. avg value = 0)</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Scale all prediction variables (scaled to Z-score)</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_intercept</span>()  <span class="co"># Add an intercept to the model</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># not using parsnip's logistic_reg, so don't convert AAER output to factor</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>prepped2 <span class="ot">&lt;-</span> rec2 <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training=</span>train)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>test_prepped2 <span class="ot">&lt;-</span> rec2 <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training=</span>test)</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co"># "Juice" your recipe to get data for other packages</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>train_x <span class="ot">&lt;-</span> <span class="fu">juice</span>(prepped2, <span class="fu">all_predictors</span>(), <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>train_y <span class="ot">&lt;-</span> <span class="fu">juice</span>(prepped2, <span class="fu">all_outcomes</span>(), <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>test_x <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prepped2, <span class="fu">all_predictors</span>(), <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>test_y <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prepped2, <span class="fu">all_outcomes</span>(), <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross validation</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">75347</span>)  <span class="co">#for reproducibility</span></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>cvfit <span class="ot">=</span> <span class="fu">cv.glmnet</span>(<span class="at">x=</span>train_x, <span class="at">y=</span>train_y, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type.measure=</span><span class="st">"auc"</span>)</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cvfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Analysis:</p>
<p>Lambda min (lower penalty) suggests around 20 variables, while lambda 1se (higher penalty) suggests around 6 to 7 variables being included in the model.</p>
<p>We use lambda.min model when we want the best performing model, as this is the model that maximises AUC. We use lambda.1se model for a simpler but more explainable model (higher penalty &gt; less variables &gt; more explainable), which still performs very well in terms of AUC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># derive optimal lambda</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>cvfit<span class="sc">$</span>lambda.min </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.173294e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>cvfit<span class="sc">$</span>lambda<span class="fl">.1</span>se </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002198539</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># deriving feature importance</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coefplot</span>(cvfit, <span class="at">lambda=</span><span class="st">'lambda.min'</span>, <span class="at">sort=</span><span class="st">'magnitude'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefplot</span>(cvfit, <span class="at">lambda=</span><span class="st">'lambda.1se'</span>, <span class="at">sort=</span><span class="st">'magnitude'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Analysis of coefficient plots:</p>
<p>lambda.min:1.173294e-06 lamdbda.1se: 0.002198539</p>
<p>The coefficient plot shows the variables retained by both models respectively, and the further away from the 0 line, the more these variables contribute to the model’s prediction. If it is to the right, it contributes more positively and if it is to the left, it contributes more negatively.</p>
<p>For the lambda.min model:</p>
<p>Most variables are close to zero with log_common_equity being abnormally large and positive. This suggests that log_common_equity is heavily influencing the performance of the lambda.min model, which might lead to biased and inconsistent predictions when new data is introduced.</p>
<p>For the lambda.1se model:</p>
<p>Most variables are closer to each other in absolute value, model is less biased towards X variables, and would perform more consistently.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting roc curve</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>train.pred_lmin2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit, train_x, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>))</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>test.pred_lmin2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit, test_x, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>))</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>train.pred_l1se2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit, train_x, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.1se"</span>))</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>test.pred_l1se2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit, test_x, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.1se"</span>))</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">train.pred_lmin2=</span>train.pred_lmin2, <span class="at">train.pred_l1se2=</span>train.pred_l1se2, <span class="at">AAER=</span><span class="fu">factor</span>(train_y, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">test.pred_lmin2=</span>test.pred_lmin2, <span class="at">test.pred_l1se2=</span>test.pred_l1se2, <span class="at">AAER=</span><span class="fu">factor</span>(test_y, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>auc_in_cv_lmin <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, train.pred_lmin2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>auc_out_cv_lmin <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, test.pred_lmin2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>curve_in_CV.min2 <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, train.pred_lmin2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>curve_out_CV.min2 <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, test.pred_lmin2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>aucs_CV.min2 <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in_cv_lmin<span class="sc">$</span>.estimate, auc_out_cv_lmin<span class="sc">$</span>.estimate)</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs_CV.min2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, lambda.min"</span>, <span class="st">"Out of sample, lambda.min"</span>)</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>auc_in_cv_l1se <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, train.pred_l1se2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>auc_out_cv_l1se <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, test.pred_l1se2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>curve_in_CV<span class="fl">.1</span>se2 <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, train.pred_l1se2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>curve_out_CV<span class="fl">.1</span>se2 <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, test.pred_l1se2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>aucs_CV<span class="fl">.1</span>se2 <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in_cv_l1se<span class="sc">$</span>.estimate, auc_out_cv_l1se<span class="sc">$</span>.estimate)</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs_CV<span class="fl">.1</span>se2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, lambda.1se"</span>, <span class="st">"Out of sample, lambda.1se"</span>)</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_in_CV.min2, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"In Sample, lambda.min"</span>)) <span class="sc">+</span> </span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_out_CV.min2, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"Out of Sample, lambda.min"</span>)) <span class="sc">+</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_in_CV<span class="fl">.1</span>se2, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"In Sample, lambda.1se"</span>)) <span class="sc">+</span> </span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_out_CV<span class="fl">.1</span>se2, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"Out of Sample, lambda.1se"</span>)) <span class="sc">+</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(aucs_CV.min2, aucs_CV<span class="fl">.1</span>se2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample, lambda.min Out of sample, lambda.min     In sample, lambda.1se 
                0.7155628                 0.6839778                 0.6888045 
Out of sample, lambda.1se 
                0.6995785 </code></pre>
</div>
</div>
<p>Analysis: Which Model do we prefer, lambda.min or lambda.1se?</p>
<p>lambda.min AUC: in-sample &gt; out-sample</p>
<p>Best performing model at the expense of potentially selecting a more complex model.</p>
<p>lambda.1se AUC: out-sample &gt; in-sample</p>
<p>A simpler model with reduced predictive performance but better at taking in new data.</p>
<p>We decide that lambda.1se is better than lambda.min, due to better explainability and out-of-sample performance (lambda1se out-sample AUC &gt; lambda.min out-sample AUC). In data science, there is often a trade-off between model explanability and performance. In this case, since the simpler model lambda.1se also happens to perform better (based on out-sample AUC), we conclude that it is the better LASSO model. Therefore, our later analysis of the important LASSO variables will be based on the lambda.1se model instead of the lambda.min model.</p>
</section>
<section id="xgboost" class="level2">
<h2 class="anchored" data-anchor-id="xgboost">3.4 Xgboost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>xgboost_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(aaer_formula, <span class="at">data =</span> train) <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Drop any variables with zero variance</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Center all prediction variables (i.e. avg value = 0)</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Scale all prediction variables (scaled to Z-score)</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_intercept</span>()</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>prepped3 <span class="ot">&lt;-</span> xgboost_rec <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training=</span>train)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>test_prepped3 <span class="ot">&lt;-</span> xgboost_rec <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training=</span>test)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>train_x3 <span class="ot">&lt;-</span> <span class="fu">juice</span>(prepped3, <span class="fu">all_predictors</span>(), <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>train_y3 <span class="ot">&lt;-</span> <span class="fu">juice</span>(prepped3, <span class="fu">all_outcomes</span>(), <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>test_x3 <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prepped3, <span class="fu">all_predictors</span>(), <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>test_y3 <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prepped3, <span class="fu">all_outcomes</span>(), <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross validation</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">482342</span>)  <span class="co">#for reproducibility</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="co"># model setup</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">max_depth=</span><span class="dv">10</span>,</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>               <span class="co"># split 9 times</span></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">eta=</span><span class="fl">0.2</span>,</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">gamma=</span><span class="dv">10</span>,</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">min_child_weight =</span> <span class="dv">5</span>,</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">objective =</span></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"binary:logistic"</span>) <span class="co"># we didn't need to convert to factor because it's done here</span></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>xgbCV <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(<span class="at">params=</span>params,</span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>train_x3, <span class="co"># x data</span></span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">label=</span>train_y3, <span class="co"># y data</span></span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrounds=</span><span class="dv">100</span>, <span class="co"># how many times to run</span></span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">eval_metric=</span><span class="st">"auc"</span>,</span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">nfold=</span><span class="dv">10</span>, <span class="co"># cross validation</span></span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">stratified=</span><span class="cn">TRUE</span>) <span class="co"># stratified sampling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.659364+0.046850 test-auc:0.617976+0.078785 
[2] train-auc:0.728824+0.008807 test-auc:0.708358+0.068104 
[3] train-auc:0.743223+0.019135 test-auc:0.708663+0.062035 
[4] train-auc:0.747583+0.016743 test-auc:0.709137+0.062483 
[5] train-auc:0.752379+0.019473 test-auc:0.710059+0.062319 
[6] train-auc:0.764536+0.021429 test-auc:0.719135+0.057939 
[7] train-auc:0.774698+0.027439 test-auc:0.729473+0.058578 
[8] train-auc:0.778818+0.024950 test-auc:0.739368+0.057489 
[9] train-auc:0.803637+0.030149 test-auc:0.758868+0.067267 
[10]    train-auc:0.831580+0.032768 test-auc:0.777798+0.055366 
[11]    train-auc:0.851017+0.029759 test-auc:0.802127+0.067378 
[12]    train-auc:0.864424+0.027098 test-auc:0.807778+0.066708 
[13]    train-auc:0.875116+0.023311 test-auc:0.820009+0.049647 
[14]    train-auc:0.881173+0.026711 test-auc:0.826303+0.050289 
[15]    train-auc:0.890639+0.022536 test-auc:0.838438+0.054536 
[16]    train-auc:0.899287+0.015073 test-auc:0.840317+0.055907 
[17]    train-auc:0.902674+0.014076 test-auc:0.849071+0.052593 
[18]    train-auc:0.902041+0.013617 test-auc:0.850922+0.052004 
[19]    train-auc:0.902680+0.012187 test-auc:0.849515+0.051283 
[20]    train-auc:0.904696+0.013620 test-auc:0.850525+0.053361 
[21]    train-auc:0.907330+0.014539 test-auc:0.853157+0.046383 
[22]    train-auc:0.911072+0.012628 test-auc:0.852302+0.049922 
[23]    train-auc:0.915553+0.012310 test-auc:0.853330+0.043991 
[24]    train-auc:0.920993+0.010840 test-auc:0.852732+0.044151 
[25]    train-auc:0.924479+0.007405 test-auc:0.853872+0.044535 
[26]    train-auc:0.927090+0.009644 test-auc:0.856496+0.044582 
[27]    train-auc:0.931777+0.011234 test-auc:0.863256+0.046601 
[28]    train-auc:0.934801+0.011027 test-auc:0.864763+0.050532 
[29]    train-auc:0.937688+0.011022 test-auc:0.871443+0.044084 
[30]    train-auc:0.943594+0.011711 test-auc:0.875004+0.048947 
[31]    train-auc:0.947046+0.013613 test-auc:0.879590+0.042894 
[32]    train-auc:0.948794+0.013491 test-auc:0.879467+0.043469 
[33]    train-auc:0.949259+0.013662 test-auc:0.879705+0.044879 
[34]    train-auc:0.950550+0.012049 test-auc:0.882534+0.042583 
[35]    train-auc:0.951591+0.012588 test-auc:0.882942+0.040760 
[36]    train-auc:0.954161+0.011417 test-auc:0.889113+0.037988 
[37]    train-auc:0.956568+0.009222 test-auc:0.891056+0.036128 
[38]    train-auc:0.957698+0.009188 test-auc:0.889939+0.036177 
[39]    train-auc:0.958594+0.009713 test-auc:0.891983+0.035737 
[40]    train-auc:0.959605+0.010112 test-auc:0.895483+0.035925 
[41]    train-auc:0.959902+0.010413 test-auc:0.896943+0.036475 
[42]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[43]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[44]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[45]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[46]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[47]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[48]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[49]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[50]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[51]    train-auc:0.960134+0.010585 test-auc:0.896932+0.036872 
[52]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[53]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[54]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[55]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[56]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[57]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[58]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[59]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[60]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[61]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[62]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[63]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[64]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[65]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[66]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[67]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[68]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[69]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[70]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[71]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[72]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[73]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[74]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[75]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[76]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[77]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[78]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[79]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[80]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[81]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[82]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[83]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[84]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[85]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[86]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[87]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[88]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[89]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[90]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[91]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[92]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[93]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[94]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[95]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[96]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[97]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[98]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[99]    train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 
[100]   train-auc:0.960311+0.010671 test-auc:0.896619+0.037217 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-run model at optimal level</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>numTrees <span class="ot">&lt;-</span> <span class="fu">min</span>(</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">which</span>(</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    xgbCV<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean <span class="sc">==</span> </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>(xgbCV<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal model is the one that maximises the validation (test) auc</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="co"># min is used to extract the smallest model number where test auc is the best</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co"># in this case, we find that it is 41</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>fit_optxgb <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">params=</span>params,</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> train_x3,</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> train_y3,</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nrounds =</span> numTrees, <span class="co"># re-run model at this optimal level</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eval_metric=</span><span class="st">"auc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.620449 
[2] train-auc:0.730835 
[3] train-auc:0.736854 
[4] train-auc:0.772400 
[5] train-auc:0.772173 
[6] train-auc:0.784468 
[7] train-auc:0.784555 
[8] train-auc:0.786371 
[9] train-auc:0.787363 
[10]    train-auc:0.820102 
[11]    train-auc:0.873923 
[12]    train-auc:0.878025 
[13]    train-auc:0.882317 
[14]    train-auc:0.922209 
[15]    train-auc:0.919408 
[16]    train-auc:0.925945 
[17]    train-auc:0.925733 
[18]    train-auc:0.924123 
[19]    train-auc:0.919711 
[20]    train-auc:0.922743 
[21]    train-auc:0.923039 
[22]    train-auc:0.914670 
[23]    train-auc:0.924087 
[24]    train-auc:0.938491 
[25]    train-auc:0.942988 
[26]    train-auc:0.942639 
[27]    train-auc:0.943946 
[28]    train-auc:0.944142 
[29]    train-auc:0.954317 
[30]    train-auc:0.954926 
[31]    train-auc:0.958159 
[32]    train-auc:0.964411 
[33]    train-auc:0.966517 
[34]    train-auc:0.966924 
[35]    train-auc:0.970268 
[36]    train-auc:0.972540 
[37]    train-auc:0.975743 
[38]    train-auc:0.975743 
[39]    train-auc:0.975743 
[40]    train-auc:0.975743 
[41]    train-auc:0.975743 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model 41, train AUC of 0.975743 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb, test_x3, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb=</span>pred.xgb, <span class="at">AAER=</span><span class="fu">factor</span>(test_y3, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb, train_x3, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb=</span>pred.xgb, <span class="at">AAER=</span><span class="fu">factor</span>(train_y3, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>auc_in_xgb <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>auc_out_xgb <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>curve_in_xgb <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>curve_out_xgb <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>aucs_xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in_xgb<span class="sc">$</span>.estimate, auc_out_xgb<span class="sc">$</span>.estimate)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs_xgb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, XGBoost"</span>, <span class="st">"Out of sample, XGBoost"</span>)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>aucs_xgb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample, XGBoost Out of sample, XGBoost 
             0.9757430              0.8446033 </code></pre>
</div>
</div>
<p>Analysis: The best overall model is the XGBoost model, as it has the highest AUC scores. This makes sense as XGBoost is able to iteratively run better models which builds upon previous models.</p>
<p>However, the model might be overfitted due to an extremely high in-sample AUC score (0.976),</p>
<p>but still performs very well on unseen data (AUC of 0.845).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>xgb.train.data <span class="ot">=</span> <span class="fu">xgb.DMatrix</span>(train_x3, <span class="at">label =</span> train_y3, <span class="at">missing =</span> <span class="cn">NA</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">=</span> <span class="fu">attr</span>(xgb.train.data, <span class="st">".Dimnames"</span>)[[<span class="dv">2</span>]]</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">=</span> <span class="fu">xgb.importance</span>(col_names, fit_optxgb)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable importance</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ffa_proj_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Lastly, these are the important variables to the xgboost model.</p>
</section>
</section>
<section id="conclusion-on-the-log--transformed-models" class="level1">
<h1>4. Conclusion on the log- transformed models</h1>
<section id="comparisons-between-the-3-classification-models" class="level2">
<h2 class="anchored" data-anchor-id="comparisons-between-the-3-classification-models">4.1 Comparisons between the 3 classification models:</h2>
<section id="performance-of-all-models-out-of-sample-auc" class="level3">
<h3 class="anchored" data-anchor-id="performance-of-all-models-out-of-sample-auc">4.1.1 Performance of all models (out-of-sample AUC)</h3>
<p>AUC metric is comprehensive and tells us information on both the specificity and sensitivity, hence it is most relevant out-of-sample metric we chose to compare across the our models.</p>
<ol type="1">
<li><p>logistic regression: 0.7451041</p></li>
<li><p>lambda.min LASSO: 0.6839778</p></li>
<li><p>lambda.1se LASSO: 0.6995785</p></li>
<li><p>xgBoost: 0.8446033</p></li>
</ol>
<p>xgBoost is the best performing model based on out-sample AUC.</p>
</section>
<section id="important-variables-across-all-models" class="level3">
<h3 class="anchored" data-anchor-id="important-variables-across-all-models">4.1.2 Important variables across all models</h3>
<p>Upon comparing the significant variables from the logistic regression, and important variables for the lambda.1se LASSO and xgBoost models, these are the common variables that are important across all models:</p>
<p>❑ Total Liabilities</p>
<p>❑ Long-term Debt</p>
<p>❑ Long-term Debt to Total Capital Ratio</p>
<p>➢ All dealing with debts and liabilities.</p>
<p>➢ Higher debts balance tends to increase the probability of accounting misstatements.</p>
<p>❑ Log Preferred Stock</p>
<p>❑ Log Preferred Stock to Total Capital Ratio</p>
<p>➢ Increased Preferred Stock tends to increase probability of accounting misstatements.</p>
<p>➢ Another form of raising money for the bank.</p>
</section>
<section id="implications" class="level3">
<h3 class="anchored" data-anchor-id="implications">4.1.3 Implications</h3>
<p>We could look into researching more into the effects of <strong>high long-term debt</strong> and <strong>preferred stock</strong> on banks and accounting misstatements, as these are the main variables consistent across our logistic regression, lasso, and xgBoost models.</p>
</section>
</section>
</section>
<section id="project-conclusion" class="level1">
<h1>5. Project conclusion</h1>
</section>
<section id="appendix-other-3-models-performance-based-on-the-auc-metric" class="level1">
<h1>6. Appendix: Other 3 models performance (based on the AUC metric)</h1>
<p>Section 5 prints out the AUC output across all the other models.</p>
<p>Creating a custom function to derive AUC for logistic regression</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>log_reg_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>logm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(AAER <span class="sc">~</span>. <span class="sc">-</span>code<span class="sc">-</span>year<span class="sc">-</span>Test, <span class="at">data=</span>df[df<span class="sc">$</span>Test<span class="sc">==</span><span class="dv">0</span>,], <span class="at">family=</span>binomial)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>pred_AAER <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm1, df, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>auc_in <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, pred_AAER, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>auc_out <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, pred_AAER, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>aucs <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in<span class="sc">$</span>.estimate, auc_out<span class="sc">$</span>.estimate)</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample AUC"</span>, <span class="st">"Out of sample AUC"</span>)</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>aucs</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Custom function for LASSO and xgboost (they use the same tidymodels framework) to derive AUC</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>lasso_xgboost_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>aaer_formula <span class="ot">&lt;-</span> aaer_eq</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co"># need to convert AAER from factor to numeric for prep() fxn to work</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AAER =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(AAER)), </span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">auditor_opinion =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(auditor_opinion)))<span class="sc">|&gt;</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">parent_auditor =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(parent_auditor)))</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>rec2 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(aaer_formula, <span class="at">data =</span> train) <span class="sc">%&gt;%</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Drop any variables with zero variance</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Center all prediction variables (i.e. avg value = 0)</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Scale all prediction variables (scaled to Z-score)</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_intercept</span>()  <span class="co"># Add an intercept to the model</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a><span class="co"># not using parsnip's logistic_reg, so don't convert AAER output to factor</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>prepped2 <span class="ot">&lt;-</span> rec2 <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training=</span>train)</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>test_prepped2 <span class="ot">&lt;-</span> rec2 <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training=</span>test)</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a><span class="co"># "Juice" your recipe to get data for other packages</span></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>train_x <span class="ot">&lt;-</span> <span class="fu">juice</span>(prepped2, <span class="fu">all_predictors</span>(), <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>train_y <span class="ot">&lt;-</span> <span class="fu">juice</span>(prepped2, <span class="fu">all_outcomes</span>(), <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>test_x <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prepped2, <span class="fu">all_predictors</span>(), <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>test_y <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prepped2, <span class="fu">all_outcomes</span>(), <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross validation</span></span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">75347</span>)  <span class="co">#for reproducibility</span></span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>cvfit <span class="ot">=</span> <span class="fu">cv.glmnet</span>(<span class="at">x=</span>train_x, <span class="at">y=</span>train_y, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type.measure=</span><span class="st">"auc"</span>)</span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting roc curve</span></span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a>train.pred_lmin2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit, train_x, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>))</span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a>test.pred_lmin2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit, test_x, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>))</span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a>train.pred_l1se2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit, train_x, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.1se"</span>))</span>
<span id="cb104-39"><a href="#cb104-39" aria-hidden="true" tabindex="-1"></a>test.pred_l1se2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit, test_x, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.1se"</span>))</span>
<span id="cb104-40"><a href="#cb104-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-41"><a href="#cb104-41" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">train.pred_lmin2=</span>train.pred_lmin2, <span class="at">train.pred_l1se2=</span>train.pred_l1se2, <span class="at">AAER=</span><span class="fu">factor</span>(train_y, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb104-42"><a href="#cb104-42" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">test.pred_lmin2=</span>test.pred_lmin2, <span class="at">test.pred_l1se2=</span>test.pred_l1se2, <span class="at">AAER=</span><span class="fu">factor</span>(test_y, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb104-43"><a href="#cb104-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-44"><a href="#cb104-44" aria-hidden="true" tabindex="-1"></a>auc_in_cv_lmin <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, train.pred_lmin2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb104-45"><a href="#cb104-45" aria-hidden="true" tabindex="-1"></a>auc_out_cv_lmin <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, test.pred_lmin2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb104-46"><a href="#cb104-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-47"><a href="#cb104-47" aria-hidden="true" tabindex="-1"></a>aucs_CV.min2 <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in_cv_lmin<span class="sc">$</span>.estimate, auc_out_cv_lmin<span class="sc">$</span>.estimate)</span>
<span id="cb104-48"><a href="#cb104-48" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs_CV.min2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, lambda.min"</span>, <span class="st">"Out of sample, lambda.min"</span>)</span>
<span id="cb104-49"><a href="#cb104-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-50"><a href="#cb104-50" aria-hidden="true" tabindex="-1"></a>auc_in_cv_l1se <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, train.pred_l1se2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb104-51"><a href="#cb104-51" aria-hidden="true" tabindex="-1"></a>auc_out_cv_l1se <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, test.pred_l1se2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb104-52"><a href="#cb104-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-53"><a href="#cb104-53" aria-hidden="true" tabindex="-1"></a>aucs_CV<span class="fl">.1</span>se2 <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in_cv_l1se<span class="sc">$</span>.estimate, auc_out_cv_l1se<span class="sc">$</span>.estimate)</span>
<span id="cb104-54"><a href="#cb104-54" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs_CV<span class="fl">.1</span>se2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, lambda.1se"</span>, <span class="st">"Out of sample, lambda.1se"</span>)</span>
<span id="cb104-55"><a href="#cb104-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-56"><a href="#cb104-56" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(aucs_CV.min2, aucs_CV<span class="fl">.1</span>se2)</span>
<span id="cb104-57"><a href="#cb104-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-58"><a href="#cb104-58" aria-hidden="true" tabindex="-1"></a>xgboost_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(aaer_formula, <span class="at">data =</span> train) <span class="sc">%&gt;%</span></span>
<span id="cb104-59"><a href="#cb104-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Drop any variables with zero variance</span></span>
<span id="cb104-60"><a href="#cb104-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Center all prediction variables (i.e. avg value = 0)</span></span>
<span id="cb104-61"><a href="#cb104-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Scale all prediction variables (scaled to Z-score)</span></span>
<span id="cb104-62"><a href="#cb104-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_intercept</span>()</span>
<span id="cb104-63"><a href="#cb104-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-64"><a href="#cb104-64" aria-hidden="true" tabindex="-1"></a>prepped3 <span class="ot">&lt;-</span> xgboost_rec <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training=</span>train)</span>
<span id="cb104-65"><a href="#cb104-65" aria-hidden="true" tabindex="-1"></a>test_prepped3 <span class="ot">&lt;-</span> xgboost_rec <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training=</span>test)</span>
<span id="cb104-66"><a href="#cb104-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-67"><a href="#cb104-67" aria-hidden="true" tabindex="-1"></a>train_x3 <span class="ot">&lt;-</span> <span class="fu">juice</span>(prepped3, <span class="fu">all_predictors</span>(), <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb104-68"><a href="#cb104-68" aria-hidden="true" tabindex="-1"></a>train_y3 <span class="ot">&lt;-</span> <span class="fu">juice</span>(prepped3, <span class="fu">all_outcomes</span>(), <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb104-69"><a href="#cb104-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-70"><a href="#cb104-70" aria-hidden="true" tabindex="-1"></a>test_x3 <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prepped3, <span class="fu">all_predictors</span>(), <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb104-71"><a href="#cb104-71" aria-hidden="true" tabindex="-1"></a>test_y3 <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prepped3, <span class="fu">all_outcomes</span>(), <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb104-72"><a href="#cb104-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-73"><a href="#cb104-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross validation</span></span>
<span id="cb104-74"><a href="#cb104-74" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">482342</span>)  <span class="co">#for reproducibility</span></span>
<span id="cb104-75"><a href="#cb104-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-76"><a href="#cb104-76" aria-hidden="true" tabindex="-1"></a><span class="co"># model setup</span></span>
<span id="cb104-77"><a href="#cb104-77" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">max_depth=</span><span class="dv">10</span>,</span>
<span id="cb104-78"><a href="#cb104-78" aria-hidden="true" tabindex="-1"></a>               <span class="co"># split 9 times</span></span>
<span id="cb104-79"><a href="#cb104-79" aria-hidden="true" tabindex="-1"></a>               <span class="at">eta=</span><span class="fl">0.2</span>,</span>
<span id="cb104-80"><a href="#cb104-80" aria-hidden="true" tabindex="-1"></a>               <span class="at">gamma=</span><span class="dv">10</span>,</span>
<span id="cb104-81"><a href="#cb104-81" aria-hidden="true" tabindex="-1"></a>               <span class="at">min_child_weight =</span> <span class="dv">5</span>,</span>
<span id="cb104-82"><a href="#cb104-82" aria-hidden="true" tabindex="-1"></a>               <span class="at">objective =</span></span>
<span id="cb104-83"><a href="#cb104-83" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"binary:logistic"</span>) <span class="co"># we didn't need to convert to factor because it's done here</span></span>
<span id="cb104-84"><a href="#cb104-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-85"><a href="#cb104-85" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb104-86"><a href="#cb104-86" aria-hidden="true" tabindex="-1"></a>xgbCV <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(<span class="at">params=</span>params,</span>
<span id="cb104-87"><a href="#cb104-87" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>train_x3, <span class="co"># x data</span></span>
<span id="cb104-88"><a href="#cb104-88" aria-hidden="true" tabindex="-1"></a>                <span class="at">label=</span>train_y3, <span class="co"># y data</span></span>
<span id="cb104-89"><a href="#cb104-89" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrounds=</span><span class="dv">100</span>, <span class="co"># how many times to run</span></span>
<span id="cb104-90"><a href="#cb104-90" aria-hidden="true" tabindex="-1"></a>                <span class="at">eval_metric=</span><span class="st">"auc"</span>,</span>
<span id="cb104-91"><a href="#cb104-91" aria-hidden="true" tabindex="-1"></a>                <span class="at">nfold=</span><span class="dv">10</span>, <span class="co"># cross validation</span></span>
<span id="cb104-92"><a href="#cb104-92" aria-hidden="true" tabindex="-1"></a>                <span class="at">stratified=</span><span class="cn">TRUE</span>) <span class="co"># stratified sampling</span></span>
<span id="cb104-93"><a href="#cb104-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-94"><a href="#cb104-94" aria-hidden="true" tabindex="-1"></a><span class="co"># re-run model at optimal level</span></span>
<span id="cb104-95"><a href="#cb104-95" aria-hidden="true" tabindex="-1"></a>numTrees <span class="ot">&lt;-</span> <span class="fu">min</span>(</span>
<span id="cb104-96"><a href="#cb104-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">which</span>(</span>
<span id="cb104-97"><a href="#cb104-97" aria-hidden="true" tabindex="-1"></a>    xgbCV<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean <span class="sc">==</span> </span>
<span id="cb104-98"><a href="#cb104-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>(xgbCV<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean)</span>
<span id="cb104-99"><a href="#cb104-99" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-100"><a href="#cb104-100" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb104-101"><a href="#cb104-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-102"><a href="#cb104-102" aria-hidden="true" tabindex="-1"></a>fit_optxgb <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">params=</span>params,</span>
<span id="cb104-103"><a href="#cb104-103" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> train_x3,</span>
<span id="cb104-104"><a href="#cb104-104" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> train_y3,</span>
<span id="cb104-105"><a href="#cb104-105" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nrounds =</span> numTrees, <span class="co"># re-run model at this optimal level</span></span>
<span id="cb104-106"><a href="#cb104-106" aria-hidden="true" tabindex="-1"></a>                      <span class="at">eval_metric=</span><span class="st">"auc"</span>)</span>
<span id="cb104-107"><a href="#cb104-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-108"><a href="#cb104-108" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb, test_x3, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb104-109"><a href="#cb104-109" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb=</span>pred.xgb, <span class="at">AAER=</span><span class="fu">factor</span>(test_y3, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb104-110"><a href="#cb104-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-111"><a href="#cb104-111" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb, train_x3, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb104-112"><a href="#cb104-112" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb=</span>pred.xgb, <span class="at">AAER=</span><span class="fu">factor</span>(train_y3, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb104-113"><a href="#cb104-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-114"><a href="#cb104-114" aria-hidden="true" tabindex="-1"></a>auc_in_xgb <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb104-115"><a href="#cb104-115" aria-hidden="true" tabindex="-1"></a>auc_out_xgb <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(AAER, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb104-116"><a href="#cb104-116" aria-hidden="true" tabindex="-1"></a>curve_in_xgb <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb104-117"><a href="#cb104-117" aria-hidden="true" tabindex="-1"></a>curve_out_xgb <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(AAER, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb104-118"><a href="#cb104-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-119"><a href="#cb104-119" aria-hidden="true" tabindex="-1"></a>aucs_xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in_xgb<span class="sc">$</span>.estimate, auc_out_xgb<span class="sc">$</span>.estimate)</span>
<span id="cb104-120"><a href="#cb104-120" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs_xgb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, XGBoost"</span>, <span class="st">"Out of sample, XGBoost"</span>)</span>
<span id="cb104-121"><a href="#cb104-121" aria-hidden="true" tabindex="-1"></a>aucs_xgb</span>
<span id="cb104-122"><a href="#cb104-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-123"><a href="#cb104-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate AUCs for xgboost</span></span>
<span id="cb104-124"><a href="#cb104-124" aria-hidden="true" tabindex="-1"></a>  aucs_xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in_xgb<span class="sc">$</span>.estimate, auc_out_xgb<span class="sc">$</span>.estimate)</span>
<span id="cb104-125"><a href="#cb104-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(aucs_xgb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, XGBoost"</span>, <span class="st">"Out of sample, XGBoost"</span>)</span>
<span id="cb104-126"><a href="#cb104-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-127"><a href="#cb104-127" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine AUCs from CV for lasso</span></span>
<span id="cb104-128"><a href="#cb104-128" aria-hidden="true" tabindex="-1"></a>  aucs_CV_combined <span class="ot">&lt;-</span> <span class="fu">c</span>(aucs_CV.min2, aucs_CV<span class="fl">.1</span>se2)</span>
<span id="cb104-129"><a href="#cb104-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(aucs_CV_combined) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, lambda.min"</span>, <span class="st">"Out of sample, lambda.min"</span>,</span>
<span id="cb104-130"><a href="#cb104-130" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"In sample, lambda.1se"</span>, <span class="st">"Out of sample, lambda.1se"</span>)</span>
<span id="cb104-131"><a href="#cb104-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-132"><a href="#cb104-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return a list containing both sets of AUCs</span></span>
<span id="cb104-133"><a href="#cb104-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">aucs_xgb =</span> aucs_xgb, <span class="at">aucs_CV_combined =</span> aucs_CV_combined))</span>
<span id="cb104-134"><a href="#cb104-134" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Splitting train test split and preparing features used in modelling</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>df_aaer2 <span class="ot">&lt;-</span> <span class="fu">split_df</span>(df_aaer2)<span class="sc">|&gt;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>market_cap)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>df_aaer4 <span class="ot">&lt;-</span> <span class="fu">split_df</span>(df_aaer4)<span class="sc">|&gt;</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>market_cap)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>df_aaer5 <span class="ot">&lt;-</span> <span class="fu">split_df</span>(df_aaer5)<span class="sc">|&gt;</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>market_cap)<span class="sc">|&gt;</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AAER=</span><span class="fu">as.factor</span>(AAER))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log_reg_auc</span>(df_aaer2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample AUC Out of sample AUC 
        0.7107280         0.7060167 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log_reg_auc</span>(df_aaer4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample AUC Out of sample AUC 
        0.7487590         0.7620953 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log_reg_auc</span>(df_aaer5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample AUC Out of sample AUC 
        0.7473695         0.7325148 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 22 variable raw model</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>aaer_eq <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"AAER ~ long_term_debt+long_term_debt_total_capital_ratio+auditor_opinion+common_stock+net_sales_or_revenues+preferred_stock+preferred_stock_total_capital_ratio+total_percent_return_on_equity+net_margin+cash_flow_sales+net_sales_over_revenues_growth+total_liabilities+total_assets+divident_payout_percent_earnings_total_dollar+parent_auditor+net_income_before_extraordinary_items+common_equity+equity_total_capital_ratio+return_on_invested_capital+fixed_charge_coverage_ratio+total_reinvestment_rate"</span>)) </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lasso_xgboost_auc</span>(df_aaer2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.659324+0.046789 test-auc:0.618596+0.078342 
[2] train-auc:0.743614+0.023882 test-auc:0.708958+0.065157 
[3] train-auc:0.762108+0.024535 test-auc:0.723703+0.061124 
[4] train-auc:0.768440+0.019782 test-auc:0.731899+0.060313 
[5] train-auc:0.768974+0.020292 test-auc:0.731590+0.060115 
[6] train-auc:0.774211+0.018126 test-auc:0.744008+0.060213 
[7] train-auc:0.786705+0.016447 test-auc:0.754373+0.056346 
[8] train-auc:0.807192+0.030895 test-auc:0.771735+0.069236 
[9] train-auc:0.808499+0.028467 test-auc:0.774017+0.068272 
[10]    train-auc:0.826285+0.035727 test-auc:0.774709+0.066405 
[11]    train-auc:0.848276+0.035583 test-auc:0.798248+0.066081 
[12]    train-auc:0.860979+0.032455 test-auc:0.809013+0.070043 
[13]    train-auc:0.867341+0.032019 test-auc:0.812319+0.072018 
[14]    train-auc:0.882132+0.022709 test-auc:0.819170+0.071863 
[15]    train-auc:0.891175+0.022419 test-auc:0.818140+0.067344 
[16]    train-auc:0.897947+0.024530 test-auc:0.820240+0.076031 
[17]    train-auc:0.904267+0.023051 test-auc:0.829342+0.072168 
[18]    train-auc:0.908168+0.020688 test-auc:0.837761+0.065284 
[19]    train-auc:0.912231+0.018616 test-auc:0.841575+0.063864 
[20]    train-auc:0.915321+0.018596 test-auc:0.840590+0.069314 
[21]    train-auc:0.917193+0.018936 test-auc:0.843892+0.067110 
[22]    train-auc:0.918194+0.016101 test-auc:0.845949+0.065935 
[23]    train-auc:0.921251+0.013366 test-auc:0.851389+0.063836 
[24]    train-auc:0.924394+0.012313 test-auc:0.856078+0.059326 
[25]    train-auc:0.930996+0.013505 test-auc:0.863960+0.047884 
[26]    train-auc:0.934854+0.014973 test-auc:0.865494+0.048964 
[27]    train-auc:0.937542+0.015101 test-auc:0.866898+0.049078 
[28]    train-auc:0.939468+0.013037 test-auc:0.869569+0.049109 
[29]    train-auc:0.943193+0.011166 test-auc:0.872160+0.048041 
[30]    train-auc:0.945095+0.010007 test-auc:0.873784+0.046105 
[31]    train-auc:0.945558+0.010133 test-auc:0.873126+0.046317 
[32]    train-auc:0.946706+0.010397 test-auc:0.874180+0.046380 
[33]    train-auc:0.948383+0.011527 test-auc:0.877152+0.046850 
[34]    train-auc:0.949624+0.011861 test-auc:0.881435+0.043516 
[35]    train-auc:0.950148+0.012276 test-auc:0.882242+0.043348 
[36]    train-auc:0.951796+0.012381 test-auc:0.886158+0.042346 
[37]    train-auc:0.952656+0.012769 test-auc:0.885661+0.042013 
[38]    train-auc:0.953295+0.013373 test-auc:0.886826+0.040630 
[39]    train-auc:0.953451+0.013557 test-auc:0.887143+0.040284 
[40]    train-auc:0.953575+0.013669 test-auc:0.887086+0.040263 
[41]    train-auc:0.953585+0.013679 test-auc:0.887410+0.040389 
[42]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[43]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[44]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[45]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[46]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[47]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[48]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[49]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[50]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[51]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[52]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[53]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[54]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[55]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[56]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[57]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[58]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[59]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[60]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[61]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[62]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[63]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[64]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[65]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[66]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[67]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[68]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[69]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[70]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[71]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[72]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[73]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[74]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[75]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[76]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[77]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[78]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[79]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[80]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[81]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[82]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[83]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[84]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[85]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[86]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[87]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[88]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[89]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[90]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[91]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[92]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[93]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[94]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[95]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[96]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[97]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[98]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[99]    train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[100]   train-auc:0.953933+0.014046 test-auc:0.889907+0.042113 
[1] train-auc:0.621883 
[2] train-auc:0.732181 
[3] train-auc:0.782086 
[4] train-auc:0.783487 
[5] train-auc:0.783235 
[6] train-auc:0.783197 
[7] train-auc:0.785326 
[8] train-auc:0.784966 
[9] train-auc:0.793807 
[10]    train-auc:0.884243 
[11]    train-auc:0.884955 
[12]    train-auc:0.884561 
[13]    train-auc:0.911204 
[14]    train-auc:0.912136 
[15]    train-auc:0.910445 
[16]    train-auc:0.917778 
[17]    train-auc:0.922263 
[18]    train-auc:0.923184 
[19]    train-auc:0.927078 
[20]    train-auc:0.931013 
[21]    train-auc:0.934970 
[22]    train-auc:0.931587 
[23]    train-auc:0.930516 
[24]    train-auc:0.930516 
[25]    train-auc:0.928035 
[26]    train-auc:0.938325 
[27]    train-auc:0.954311 
[28]    train-auc:0.953307 
[29]    train-auc:0.954128 
[30]    train-auc:0.960657 
[31]    train-auc:0.960657 
[32]    train-auc:0.962774 
[33]    train-auc:0.965352 
[34]    train-auc:0.965913 
[35]    train-auc:0.969196 
[36]    train-auc:0.969196 
[37]    train-auc:0.972320 
[38]    train-auc:0.975698 
[39]    train-auc:0.975698 
[40]    train-auc:0.975698 
[41]    train-auc:0.975698 
[42]    train-auc:0.975698 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$aucs_xgb
    In sample, XGBoost Out of sample, XGBoost 
             0.9756983              0.6607232 

$aucs_CV_combined
    In sample, lambda.min Out of sample, lambda.min     In sample, lambda.1se 
                0.6974038                 0.6733187                 0.6653501 
Out of sample, lambda.1se 
                0.6987844 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 22 variable percent change log model (added percent change to the 8 variables)</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>aaer_eq <span class="ot">&lt;-</span><span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"AAER ~ change_in_long_term_debt+long_term_debt_total_capital_ratio+auditor_opinion+change_in_log_common_stock+change_in_log_net_sales_or_revenues+log_preferred_stock_total_capital_ratio+log_total_percent_return_on_equity+log_net_margin+log_cash_flow_sales+log_net_sales_over_revenues_growth+change_in_total_liabilities+change_in_total_assets+divident_payout_percent_earnings_total_dollar+parent_auditor+change_in_log_net_income_before_extraordinary_items+change_in_log_common_equity+log_equity_total_capital_ratio+log_return_on_invested_capital+log_fixed_charge_coverage_ratio+log_total_reinvestment_rate+change_in_log_preferred_stock"</span>))</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lasso_xgboost_auc</span>(df_aaer4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.623411+0.085356 test-auc:0.614321+0.092945 
[2] train-auc:0.646776+0.079544 test-auc:0.627190+0.088296 
[3] train-auc:0.697740+0.063025 test-auc:0.667981+0.075947 
[4] train-auc:0.736453+0.008985 test-auc:0.710176+0.072126 
[5] train-auc:0.741462+0.008958 test-auc:0.713892+0.073328 
[6] train-auc:0.745154+0.007972 test-auc:0.721839+0.068567 
[7] train-auc:0.748222+0.007044 test-auc:0.730535+0.067715 
[8] train-auc:0.749217+0.008045 test-auc:0.736310+0.058949 
[9] train-auc:0.754958+0.007583 test-auc:0.737821+0.054166 
[10]    train-auc:0.773988+0.011473 test-auc:0.755902+0.050324 
[11]    train-auc:0.786854+0.023901 test-auc:0.760886+0.051935 
[12]    train-auc:0.804954+0.024840 test-auc:0.775261+0.048810 
[13]    train-auc:0.815416+0.021957 test-auc:0.779769+0.053116 
[14]    train-auc:0.818897+0.019686 test-auc:0.792799+0.055110 
[15]    train-auc:0.818331+0.018575 test-auc:0.790751+0.056088 
[16]    train-auc:0.832150+0.015234 test-auc:0.805527+0.047492 
[17]    train-auc:0.842180+0.013271 test-auc:0.817191+0.056931 
[18]    train-auc:0.850327+0.014050 test-auc:0.820522+0.055553 
[19]    train-auc:0.855332+0.013903 test-auc:0.827733+0.049827 
[20]    train-auc:0.862027+0.013069 test-auc:0.834317+0.054870 
[21]    train-auc:0.865877+0.012904 test-auc:0.834770+0.058157 
[22]    train-auc:0.872913+0.010410 test-auc:0.837411+0.057434 
[23]    train-auc:0.876218+0.007909 test-auc:0.840361+0.058634 
[24]    train-auc:0.880550+0.007582 test-auc:0.847117+0.057885 
[25]    train-auc:0.885194+0.008644 test-auc:0.847715+0.057425 
[26]    train-auc:0.891380+0.009252 test-auc:0.854914+0.052740 
[27]    train-auc:0.897520+0.007211 test-auc:0.857335+0.049336 
[28]    train-auc:0.903679+0.008791 test-auc:0.857204+0.049352 
[29]    train-auc:0.907580+0.009627 test-auc:0.857833+0.049094 
[30]    train-auc:0.910613+0.007338 test-auc:0.859931+0.047955 
[31]    train-auc:0.912420+0.006905 test-auc:0.861384+0.048796 
[32]    train-auc:0.916046+0.009123 test-auc:0.860880+0.046634 
[33]    train-auc:0.918509+0.010445 test-auc:0.860255+0.047121 
[34]    train-auc:0.920236+0.011354 test-auc:0.860340+0.046672 
[35]    train-auc:0.921315+0.012233 test-auc:0.860604+0.046867 
[36]    train-auc:0.921315+0.012233 test-auc:0.860604+0.046867 
[37]    train-auc:0.921315+0.012233 test-auc:0.860604+0.046867 
[38]    train-auc:0.921315+0.012233 test-auc:0.860604+0.046867 
[39]    train-auc:0.921315+0.012233 test-auc:0.860604+0.046867 
[40]    train-auc:0.921600+0.012669 test-auc:0.860667+0.046870 
[41]    train-auc:0.921600+0.012669 test-auc:0.860667+0.046870 
[42]    train-auc:0.921721+0.012443 test-auc:0.860232+0.046748 
[43]    train-auc:0.922144+0.011709 test-auc:0.861222+0.047077 
[44]    train-auc:0.923098+0.010441 test-auc:0.862503+0.047774 
[45]    train-auc:0.924148+0.009753 test-auc:0.862350+0.048166 
[46]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[47]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[48]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[49]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[50]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[51]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[52]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[53]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[54]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[55]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[56]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[57]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[58]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[59]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[60]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[61]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[62]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[63]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[64]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[65]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[66]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[67]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[68]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[69]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[70]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[71]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[72]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[73]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[74]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[75]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[76]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[77]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[78]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[79]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[80]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[81]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[82]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[83]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[84]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[85]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[86]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[87]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[88]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[89]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[90]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[91]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[92]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[93]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[94]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[95]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[96]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[97]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[98]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[99]    train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[100]   train-auc:0.925209+0.009532 test-auc:0.862828+0.048263 
[1] train-auc:0.603844 
[2] train-auc:0.744559 
[3] train-auc:0.744559 
[4] train-auc:0.747263 
[5] train-auc:0.747220 
[6] train-auc:0.747623 
[7] train-auc:0.748925 
[8] train-auc:0.749707 
[9] train-auc:0.777535 
[10]    train-auc:0.779276 
[11]    train-auc:0.779485 
[12]    train-auc:0.780529 
[13]    train-auc:0.818446 
[14]    train-auc:0.818771 
[15]    train-auc:0.815621 
[16]    train-auc:0.836596 
[17]    train-auc:0.840350 
[18]    train-auc:0.848425 
[19]    train-auc:0.868016 
[20]    train-auc:0.873078 
[21]    train-auc:0.872088 
[22]    train-auc:0.873134 
[23]    train-auc:0.873173 
[24]    train-auc:0.875400 
[25]    train-auc:0.899680 
[26]    train-auc:0.902814 
[27]    train-auc:0.910320 
[28]    train-auc:0.917604 
[29]    train-auc:0.917604 
[30]    train-auc:0.917604 
[31]    train-auc:0.920555 
[32]    train-auc:0.925838 
[33]    train-auc:0.925838 
[34]    train-auc:0.928537 
[35]    train-auc:0.933715 
[36]    train-auc:0.935950 
[37]    train-auc:0.940451 
[38]    train-auc:0.940451 
[39]    train-auc:0.940451 
[40]    train-auc:0.940451 
[41]    train-auc:0.940451 
[42]    train-auc:0.940451 
[43]    train-auc:0.940451 
[44]    train-auc:0.940451 
[45]    train-auc:0.940451 
[46]    train-auc:0.940451 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$aucs_xgb
    In sample, XGBoost Out of sample, XGBoost 
             0.9404513              0.7922464 

$aucs_CV_combined
    In sample, lambda.min Out of sample, lambda.min     In sample, lambda.1se 
                0.6858110                 0.7047249                 0.6549695 
Out of sample, lambda.1se 
                0.6966743 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 22 variable currency adjusted model (adjusting the 8 raw variables to USD)</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>aaer_eq <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"AAER ~ adj_net_income_before_extraordinary_items+adj_common_equity+adj_total_liabilities+adj_long_term_debt+adj_total_assets+adj_net_sales_or_revenues+long_term_debt_total_capital_ratio+divident_payout_percent_earnings_total_dollar+auditor_opinion+parent_auditor+log_adj_common_stock+log_adj_preferred_stock+log_equity_total_capital_ratio+log_preferred_stock_total_capital_ratio+log_total_debt_total_capital_ratio+log_total_percent_return_on_equity+log_return_on_invested_capital+log_net_margin+log_fixed_charge_coverage_ratio+log_cash_flow_sales+log_total_reinvestment_rate+log_net_sales_over_revenues_growth"</span>))</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lasso_xgboost_auc</span>(df_aaer5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.674838+0.047723 test-auc:0.631014+0.080492 
[2] train-auc:0.727632+0.021498 test-auc:0.704116+0.062962 
[3] train-auc:0.738904+0.011262 test-auc:0.711056+0.059826 
[4] train-auc:0.749910+0.023664 test-auc:0.719110+0.054767 
[5] train-auc:0.751014+0.022831 test-auc:0.722282+0.053717 
[6] train-auc:0.751532+0.022841 test-auc:0.722404+0.054450 
[7] train-auc:0.770219+0.026177 test-auc:0.740937+0.064917 
[8] train-auc:0.780919+0.027702 test-auc:0.745274+0.069015 
[9] train-auc:0.793019+0.038598 test-auc:0.749345+0.070592 
[10]    train-auc:0.814449+0.036300 test-auc:0.765432+0.072653 
[11]    train-auc:0.844869+0.035764 test-auc:0.813724+0.066942 
[12]    train-auc:0.857174+0.033743 test-auc:0.821597+0.073692 
[13]    train-auc:0.862951+0.030084 test-auc:0.818910+0.077072 
[14]    train-auc:0.868555+0.029011 test-auc:0.820909+0.071090 
[15]    train-auc:0.875620+0.021743 test-auc:0.825930+0.064114 
[16]    train-auc:0.884643+0.015649 test-auc:0.829045+0.059633 
[17]    train-auc:0.891326+0.008672 test-auc:0.838787+0.061746 
[18]    train-auc:0.895993+0.010456 test-auc:0.843394+0.054945 
[19]    train-auc:0.901506+0.012868 test-auc:0.845382+0.053810 
[20]    train-auc:0.907353+0.014882 test-auc:0.846734+0.056059 
[21]    train-auc:0.910067+0.014892 test-auc:0.850358+0.059840 
[22]    train-auc:0.916138+0.009857 test-auc:0.855231+0.054436 
[23]    train-auc:0.923896+0.012212 test-auc:0.869166+0.055414 
[24]    train-auc:0.929508+0.014112 test-auc:0.867464+0.050677 
[25]    train-auc:0.931584+0.014787 test-auc:0.865032+0.052516 
[26]    train-auc:0.934196+0.014591 test-auc:0.864178+0.050916 
[27]    train-auc:0.938350+0.011452 test-auc:0.875040+0.042028 
[28]    train-auc:0.941977+0.011022 test-auc:0.877549+0.042536 
[29]    train-auc:0.944693+0.009615 test-auc:0.876932+0.042067 
[30]    train-auc:0.947142+0.008752 test-auc:0.880535+0.041118 
[31]    train-auc:0.951454+0.008758 test-auc:0.882975+0.043238 
[32]    train-auc:0.953309+0.008206 test-auc:0.885017+0.041059 
[33]    train-auc:0.956028+0.005773 test-auc:0.886091+0.038125 
[34]    train-auc:0.958012+0.006395 test-auc:0.887629+0.037756 
[35]    train-auc:0.959119+0.007805 test-auc:0.887906+0.038915 
[36]    train-auc:0.959121+0.007809 test-auc:0.888092+0.039187 
[37]    train-auc:0.959757+0.007831 test-auc:0.888562+0.039222 
[38]    train-auc:0.960595+0.007600 test-auc:0.889340+0.039800 
[39]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[40]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[41]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[42]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[43]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[44]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[45]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[46]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[47]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[48]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[49]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[50]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[51]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[52]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[53]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[54]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[55]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[56]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[57]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[58]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[59]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[60]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[61]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[62]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[63]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[64]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[65]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[66]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[67]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[68]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[69]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[70]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[71]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[72]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[73]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[74]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[75]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[76]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[77]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[78]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[79]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[80]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[81]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[82]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[83]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[84]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[85]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[86]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[87]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[88]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[89]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[90]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[91]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[92]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[93]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[94]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[95]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[96]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[97]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[98]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[99]    train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[100]   train-auc:0.960710+0.007547 test-auc:0.889362+0.039810 
[1] train-auc:0.715004 
[2] train-auc:0.718070 
[3] train-auc:0.733883 
[4] train-auc:0.739703 
[5] train-auc:0.782320 
[6] train-auc:0.781762 
[7] train-auc:0.781864 
[8] train-auc:0.782259 
[9] train-auc:0.784452 
[10]    train-auc:0.849777 
[11]    train-auc:0.870584 
[12]    train-auc:0.872332 
[13]    train-auc:0.873859 
[14]    train-auc:0.872836 
[15]    train-auc:0.886426 
[16]    train-auc:0.883173 
[17]    train-auc:0.892744 
[18]    train-auc:0.895185 
[19]    train-auc:0.897837 
[20]    train-auc:0.923989 
[21]    train-auc:0.931737 
[22]    train-auc:0.935871 
[23]    train-auc:0.940026 
[24]    train-auc:0.940586 
[25]    train-auc:0.946142 
[26]    train-auc:0.948299 
[27]    train-auc:0.948299 
[28]    train-auc:0.948299 
[29]    train-auc:0.946951 
[30]    train-auc:0.954588 
[31]    train-auc:0.955985 
[32]    train-auc:0.960779 
[33]    train-auc:0.962312 
[34]    train-auc:0.967390 
[35]    train-auc:0.969484 
[36]    train-auc:0.969484 
[37]    train-auc:0.969484 
[38]    train-auc:0.969484 
[39]    train-auc:0.969484 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$aucs_xgb
    In sample, XGBoost Out of sample, XGBoost 
             0.9694841              0.8264798 

$aucs_CV_combined
    In sample, lambda.min Out of sample, lambda.min     In sample, lambda.1se 
                0.7038530                 0.6973123                 0.6834450 
Out of sample, lambda.1se 
                0.6864822 </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>